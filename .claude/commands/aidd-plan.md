---
allowed-tools: Read(*), Glob(*), Grep(*), Edit(**/*.md), Write(**/*.md), Bash(git :*), Bash(python3 :*)
description: –°–æ–∑–¥–∞—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –ø–ª–∞–Ω –¥–ª—è –Ω–æ–≤–æ–≥–æ MVP –ø—Ä–æ–µ–∫—Ç–∞
---

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ (Migration Mode v2.4):** –§—Ä–µ–π–º–≤–æ—Ä–∫ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–±–µ –≤–µ—Ä—Å–∏–∏ –∫–æ–º–∞–Ω–¥ ‚Äî legacy naming (`/aidd-idea`, `/aidd-generate`, `/aidd-finalize`, `/aidd-feature-plan`) –∏ new naming (`/aidd-analyze`, `/aidd-code`, `/aidd-validate`, `/aidd-plan-feature`) —Ä–∞–±–æ—Ç–∞—é—Ç –∏–¥–µ–Ω—Ç–∏—á–Ω–æ.


> ‚ö†Ô∏è **ENFORCEMENT**: –ü–µ—Ä–µ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã AI –û–ë–Ø–ó–ê–ù:
> 1. –ù–∞–π—Ç–∏ —Å–µ–∫—Ü–∏—é "–ß–µ–∫–ª–∏—Å—Ç –≤–æ—Ä–æ—Ç" –≤ –∫–æ–Ω—Ü–µ —ç—Ç–æ–≥–æ —Ñ–∞–π–ª–∞
> 2. –°–æ–∑–¥–∞—Ç—å TodoWrite —Å–æ –í–°–ï–ú–ò –ø—É–Ω–∫—Ç–∞–º–∏ (–æ—Å–æ–±–µ–Ω–Ω–æ üî¥)
> 3. –í—ã–ø–æ–ª–Ω–∏—Ç—å –í–°–ï –ø—É–Ω–∫—Ç—ã –∏ –æ—Ç–º–µ—Ç–∏—Ç—å completed
> 4. –ö–æ–º–∞–Ω–¥–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –¢–û–õ–¨–ö–û –∫–æ–≥–¥–∞ –≤—Å–µ üî¥ –ø—É–Ω–∫—Ç—ã ‚úÖ
>
> –ü—Ä–∞–≤–∏–ª–∞: `.aidd/CLAUDE.md` ‚Üí "–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ /aidd-*"

# –ö–æ–º–∞–Ω–¥–∞: /plan

> –ó–∞–ø—É—Å–∫–∞–µ—Ç –ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä–∞ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã (—Ä–µ–∂–∏–º CREATE).
> **Pipeline State v2**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –ø–∞–π–ø–ª–∞–π–Ω–æ–≤.

---

## –°–∏–Ω—Ç–∞–∫—Å–∏—Å

```bash
/plan
```

---

## –û–ø–∏—Å–∞–Ω–∏–µ

–ö–æ–º–∞–Ω–¥–∞ `/aidd-plan` —Å–æ–∑–¥–∞—ë—Ç –ø–æ–ª–Ω—ã–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –ø–ª–∞–Ω –¥–ª—è –Ω–æ–≤–æ–≥–æ MVP –ø—Ä–æ–µ–∫—Ç–∞.
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ä–µ–∂–∏–º–µ CREATE –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã —Å –Ω—É–ª—è.

> **VERIFY BEFORE ACT**: –ü–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º —Ñ–∞–π–ª–æ–≤/–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∏—Ö
> —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ (—Å–º. CLAUDE.md, —Ä–∞–∑–¥–µ–ª "–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞").

---

## –ê–≥–µ–Ω—Ç

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä** (`.claude/agents/architect.md`)

---

## –ü–æ—Ä—è–¥–æ–∫ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤

> **–ü—Ä–∏–Ω—Ü–∏–ø**: –°–Ω–∞—á–∞–ª–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç –¶–ü, –ø–æ—Ç–æ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞.
> **–ü–æ–¥—Ä–æ–±–Ω–µ–µ**: [docs/initialization.md](../../docs/initialization.md)

### –§–∞–∑–∞ 1: –ö–æ–Ω—Ç–µ–∫—Å—Ç —Ü–µ–ª–µ–≤–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞

| # | –§–∞–π–ª | –£—Å–ª–æ–≤–∏–µ | –ó–∞—á–µ–º |
|---|------|---------|-------|
| 1 | `./CLAUDE.md` | –ï—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç | –°–ø–µ—Ü–∏—Ñ–∏–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ |
| 2 | `./.pipeline-state.json` | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ | –†–µ–∂–∏–º, —ç—Ç–∞–ø, –≤–æ—Ä–æ—Ç–∞ |
| 3 | `./ai-docs/docs/prd/*.md` | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ | –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∏–∑ PRD |

### –§–∞–∑–∞ 2: –ê–≤—Ç–æ–º–∏–≥—Ä–∞—Ü–∏—è –∏ –ø—Ä–µ–¥—É—Å–ª–æ–≤–∏—è

> **–í–∞–∂–Ω–æ**: –ü–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –∫–æ–º–∞–Ω–¥—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Ä—Å–∏—é `.pipeline-state.json`
> –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é v1 ‚Üí v2 –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è (—Å–º. `knowledge/pipeline/automigration.md`).

| –í–æ—Ä–æ—Ç–∞ | –ü—Ä–æ–≤–µ—Ä–∫–∞ (v2) |
|--------|---------------|
| `PRD_READY` | `active_pipelines[FID].gates.PRD_READY.passed == true` |
| `RESEARCH_DONE` | `active_pipelines[FID].gates.RESEARCH_DONE.passed == true` |

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ v2**: FID –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ —Ç–µ–∫—É—â–µ–π git –≤–µ—Ç–∫–µ.

### –§–∞–∑–∞ 3: –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞

| # | –§–∞–π–ª | –ó–∞—á–µ–º |
|---|------|-------|
| 4 | `.aidd/CLAUDE.md` | –ü—Ä–∞–≤–∏–ª–∞ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞ |
| 5 | `.aidd/workflow.md` | –ü—Ä–æ—Ü–µ—Å—Å –∏ –≤–æ—Ä–æ—Ç–∞ |
| 6 | `.aidd/.claude/commands/plan.md` | –≠—Ç–æ—Ç —Ñ–∞–π–ª |
| 7 | `.aidd/.claude/agents/architect.md` | –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —Ä–æ–ª–∏ |

### –§–∞–∑–∞ 4: –®–∞–±–ª–æ–Ω—ã –∏ –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π

| # | –§–∞–π–ª | –£—Å–ª–æ–≤–∏–µ |
|---|------|---------|
| 8 | `.aidd/templates/documents/architecture-template.md` | –î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞–Ω–∞ |
| 9 | `.aidd/knowledge/architecture/ddd-hexagonal.md` | –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã |
| 10 | `.aidd/knowledge/architecture/http-only.md` | HTTP-only –¥–æ—Å—Ç—É–ø |

---

## –†–µ–∂–∏–º—ã

–¢–æ–ª—å–∫–æ **CREATE** ‚Äî –¥–ª—è –Ω–æ–≤—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤.

–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ñ–∏—á–∏ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `/aidd-feature-plan`.

---

## –ü—Ä–µ–¥—É—Å–ª–æ–≤–∏—è

| –í–æ—Ä–æ—Ç–∞ | –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ |
|--------|------------|
| `PRD_READY` | PRD –¥–æ–∫—É–º–µ–Ω—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç |
| `RESEARCH_DONE` | –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ |

### –ê–ª–≥–æ—Ä–∏—Ç–º –ø—Ä–æ–≤–µ—Ä–∫–∏ (v2)

```python
def check_plan_preconditions() -> tuple[str, dict] | None:
    """
    –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–µ–¥—É—Å–ª–æ–≤–∏—è –¥–ª—è /plan.

    v2: –û–ø—Ä–µ–¥–µ–ª—è–µ–º FID –ø–æ git –≤–µ—Ç–∫–µ, –ø—Ä–æ–≤–µ—Ä—è–µ–º active_pipelines[fid].gates
    """
    # 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å state
    state = ensure_v2_state()  # —Å–º. knowledge/pipeline/automigration.md
    if not state:
        print("‚ùå –ü–∞–π–ø–ª–∞–π–Ω –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω ‚Üí /aidd-idea")
        return None

    # 2. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å FID –ø–æ —Ç–µ–∫—É—â–µ–π git –≤–µ—Ç–∫–µ
    fid, pipeline = get_current_feature_context(state)
    if not fid:
        print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ñ–∏—á–∏")
        return None

    gates = pipeline.get("gates", {})

    # 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å PRD_READY
    if not gates.get("PRD_READY", {}).get("passed"):
        print(f"‚ùå –í–æ—Ä–æ—Ç–∞ PRD_READY –Ω–µ –ø—Ä–æ–π–¥–µ–Ω—ã –¥–ª—è {fid}")
        print("   ‚Üí –°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ /aidd-idea")
        return None

    # 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å RESEARCH_DONE
    if not gates.get("RESEARCH_DONE", {}).get("passed"):
        print(f"‚ùå –í–æ—Ä–æ—Ç–∞ RESEARCH_DONE –Ω–µ –ø—Ä–æ–π–¥–µ–Ω—ã –¥–ª—è {fid}")
        print("   ‚Üí –°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ /aidd-research")
        return None

    print(f"‚úì –§–∏—á–∞ {fid}: {pipeline.get('title')}")
    return (fid, pipeline)
```

---

## –í—ã—Ö–æ–¥–Ω—ã–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã (–≤ —Ü–µ–ª–µ–≤–æ–º –ø—Ä–æ–µ–∫—Ç–µ)

| –ê—Ä—Ç–µ—Ñ–∞–∫—Ç | –ü—É—Ç—å (v2) | –ü—É—Ç—å (v3) |
|----------|-----------|-----------|
| –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –ø–ª–∞–Ω (MVP) | `ai-docs/docs/architecture/{YYYY-MM-DD}_{FID}_{slug}-plan.md` | `ai-docs/docs/_plans/mvp/{YYYY-MM-DD}_{FID}_{slug}.md` |

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ (v2.4+)**:
> - **v2** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é): –°—Ç–∞—Ä–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `architecture/`, –∏–º—è —Å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º `{name}-plan.md`
> - **v3** (–ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏): –ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `_plans/mvp/`, –∏–º—è –±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è `{name}.md`
> - –†–µ–∂–∏–º –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∏–∑ `.pipeline-state.json ‚Üí naming_version`

### –ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞

FID –∏ slug –±–µ—Ä—É—Ç—Å—è –∏–∑ `active_pipelines[FID]` –≤ `.pipeline-state.json` (v2):

```python
# –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ state (v2)
fid, pipeline = get_current_feature_context(state)
if not fid:
    print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ñ–∏—á–∏")
    return None

slug = pipeline["name"]  # table-booking
date = datetime.now().strftime("%Y-%m-%d")  # 2024-12-23

# –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å naming_version –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤
naming_version = state.get("naming_version", "v2")

if naming_version == "v3":
    folder = "_plans/mvp"
    filename = f"{date}_{fid}_{slug}.md"  # –ë–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
else:
    folder = "architecture"
    filename = f"{date}_{fid}_{slug}-plan.md"  # –° –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º

artifact_path = f"{folder}/{filename}"
# v2: architecture/2024-12-23_F001_table-booking-plan.md
# v3: _plans/mvp/2024-12-23_F001_table-booking.md
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ .pipeline-state.json

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞–Ω–∞ –æ–±–Ω–æ–≤–∏—Ç—å `active_pipelines[FID].artifacts` (v2):

**–ü—Ä–∏–º–µ—Ä –¥–ª—è v2 (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)**:
```json
{
  "naming_version": "v2",
  "active_pipelines": {
    "F001": {
      "branch": "feature/F001-table-booking",
      "name": "table-booking",
      "title": "–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–æ–ª–∏–∫–æ–≤",
      "stage": "PLAN",
      "gates": {
        "PRD_READY": {"passed": true, "passed_at": "2024-12-23T10:00:00Z"},
        "RESEARCH_DONE": {"passed": true, "passed_at": "2024-12-23T11:00:00Z"},
        "PLAN_APPROVED": {"passed": false}
      },
      "artifacts": {
        "prd": "prd/2024-12-23_F001_table-booking-prd.md",
        "research": "research/2024-12-23_F001_table-booking-research.md",
        "plan": "architecture/2024-12-23_F001_table-booking-plan.md"
      }
    }
  }
}
```

**–ü—Ä–∏–º–µ—Ä –¥–ª—è v3 (–ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏)**:
```json
{
  "naming_version": "v3",
  "active_pipelines": {
    "F001": {
      "artifacts": {
        "prd": "_analysis/2024-12-23_F001_table-booking.md",
        "research": "_research/2024-12-23_F001_table-booking.md",
        "plan": "_plans/mvp/2024-12-23_F001_table-booking.md"
      }
    }
  }
}
```

---

## –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤–æ—Ä–æ—Ç–∞

### PLAN_APPROVED

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|
| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã | –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã |
| API –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã | –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã –∏ —Å—Ö–µ–º—ã –æ–ø–∏—Å–∞–Ω—ã |
| NFR | –ù–µ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è —É—á—Ç–µ–Ω—ã |
| **–£—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ** | –ü–ª–∞–Ω —É—Ç–≤–µ—Ä–∂–¥—ë–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º |

**–í–ê–ñ–ù–û**: –¢—Ä–µ–±—É–µ—Ç—Å—è —è–≤–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!

---

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```bash
# –ü–æ—Å–ª–µ /research
/plan
```

---

## –ß–µ–∫–ª–∏—Å—Ç –≤–æ—Ä–æ—Ç PLAN_APPROVED

> ‚ö†Ô∏è AI –û–ë–Ø–ó–ê–ù —Å–æ–∑–¥–∞—Ç—å TodoWrite —Å —ç—Ç–∏–º–∏ –ø—É–Ω–∫—Ç–∞–º–∏.

- [ ] üî¥ Architecture Plan —Å–æ–∑–¥–∞–Ω –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ø–∞–ø–∫–µ:
  - v2: `ai-docs/docs/architecture/{name}-plan.md`
  - v3: `ai-docs/docs/_plans/mvp/{name}.md`
- [ ] üî¥ –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã —Å —Ç–∏–ø–∞–º–∏
- [ ] üî¥ API –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –æ–ø–∏—Å–∞–Ω—ã
- [ ] üî¥ **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Ç–≤–µ—Ä–¥–∏–ª –ø–ª–∞–Ω** ‚Üê –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û
- [ ] üî¥ `.pipeline-state.json` –æ–±–Ω–æ–≤–ª—ë–Ω (gate: PLAN_APPROVED, artifact path —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç naming_version)
- [ ] üü° ADR –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã

---

## –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥

–ü–æ—Å–ª–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –≤–æ—Ä–æ—Ç `PLAN_APPROVED`:

```bash
/generate
```
