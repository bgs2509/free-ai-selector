---
allowed-tools: Read(*), Glob(*), Grep(*), Bash(pytest :*), Bash(make :*), Edit(**/*.md), Write(**/*.md)
description: Запуск тестов и проверка покрытия кода
---

# Команда: /test

> Запускает QA для тестирования и верификации.

---

## Синтаксис

```bash
/test
```

---

## Описание

Команда `/aidd-test` выполняет:
- Запуск всех тестов
- Проверку покрытия кода
- Верификацию требований из PRD
- Формирование QA отчёта

> **VERIFY BEFORE ACT**: Перед созданием файлов/директорий проверьте их
> существование (см. CLAUDE.md, раздел "Критические правила").

---

## Агент

**QA** (`.claude/agents/qa.md`)

---

## Порядок чтения файлов

> **Принцип**: Сначала контекст ЦП, потом инструкции фреймворка.
> **Подробнее**: [docs/initialization.md](../../docs/initialization.md)

### Фаза 1: Контекст целевого проекта

| # | Файл | Условие | Зачем |
|---|------|---------|-------|
| 1 | `./CLAUDE.md` | Если существует | Специфика проекта |
| 2 | `./.pipeline-state.json` | Обязательно | Режим, этап, ворота |
| 3 | `./ai-docs/docs/prd/*.md` | Обязательно | Требования для верификации |
| 4 | `./services/*/tests/` | Обязательно | Существующие тесты |

### Фаза 2: Предусловия

| Ворота | Проверка |
|--------|----------|
| `REVIEW_OK` | `.pipeline-state.json → gates.REVIEW_OK.passed == true` |

### Фаза 3: Инструкции фреймворка

| # | Файл | Зачем |
|---|------|-------|
| 5 | `.aidd/CLAUDE.md` | Правила фреймворка |
| 6 | `.aidd/workflow.md` | Процесс и ворота |
| 7 | `.aidd/.claude/commands/test.md` | Этот файл |
| 8 | `.aidd/.claude/agents/qa.md` | Инструкции роли |

### Фаза 4: База знаний

| # | Файл | Условие |
|---|------|---------|
| 9 | `.aidd/knowledge/quality/testing.md` | Практики тестирования |

---

## Предусловия

| Ворота | Требование |
|--------|------------|
| `REVIEW_OK` | Код прошёл ревью |

### Алгоритм проверки

```
1. Проверить существование .pipeline-state.json
2. Если файл отсутствует:
   ❌ Пайплайн не инициализирован
   → Сначала выполните /idea
3. Проверить gates.REVIEW_OK.passed == true
4. Если ворота не пройдены:
   ❌ Ворота REVIEW_OK не пройдены
   → Сначала выполните /review
5. Продолжить выполнение
```

---

## Выходные артефакты (в целевом проекте)

| Артефакт | Путь |
|----------|------|
| QA отчёт | `ai-docs/docs/reports/qa-report.md` |

---

## Качественные ворота

### QA_PASSED

| Критерий | Описание |
|----------|----------|
| Тесты | Все тесты проходят (0 failed) |
| Покрытие | Coverage ≥75% |
| Баги | Нет Critical/Blocker багов |
| Требования | Все FR-* верифицированы |

---

## Команды тестирования

```bash
# Unit-тесты
pytest tests/unit/ -v

# Integration-тесты
pytest tests/integration/ -v

# С покрытием
pytest --cov=src --cov-report=html --cov-fail-under=75

# Через Makefile
make test
```

---

## Примеры использования

```bash
# После /review
/test
```

---

## Следующий шаг

После прохождения ворот `QA_PASSED`:

```bash
/validate
```
