---
allowed-tools: Read(*), Glob(*), Grep(*), Bash(git :*), Bash(python3 :*)
description: –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π
---

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ (Migration Mode v2.4):** –§—Ä–µ–π–º–≤–æ—Ä–∫ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–±–µ –≤–µ—Ä—Å–∏–∏ –∫–æ–º–∞–Ω–¥ ‚Äî legacy naming (`/aidd-idea`, `/aidd-generate`, `/aidd-finalize`, `/aidd-feature-plan`) –∏ new naming (`/aidd-analyze`, `/aidd-code`, `/aidd-validate`, `/aidd-plan-feature`) —Ä–∞–±–æ—Ç–∞—é—Ç –∏–¥–µ–Ω—Ç–∏—á–Ω–æ.


> ‚ö†Ô∏è **ENFORCEMENT**: –ü–µ—Ä–µ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã AI –û–ë–Ø–ó–ê–ù:
> 1. –ù–∞–π—Ç–∏ —Å–µ–∫—Ü–∏—é "–ß–µ–∫–ª–∏—Å—Ç –≤–æ—Ä–æ—Ç" –≤ –∫–æ–Ω—Ü–µ —ç—Ç–æ–≥–æ —Ñ–∞–π–ª–∞
> 2. –°–æ–∑–¥–∞—Ç—å TodoWrite —Å–æ –í–°–ï–ú–ò –ø—É–Ω–∫—Ç–∞–º–∏ (–æ—Å–æ–±–µ–Ω–Ω–æ üî¥)
> 3. –í—ã–ø–æ–ª–Ω–∏—Ç—å –í–°–ï –ø—É–Ω–∫—Ç—ã –∏ –æ—Ç–º–µ—Ç–∏—Ç—å completed
> 4. –ö–æ–º–∞–Ω–¥–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –¢–û–õ–¨–ö–û –∫–æ–≥–¥–∞ –≤—Å–µ üî¥ –ø—É–Ω–∫—Ç—ã ‚úÖ
>
> –ü—Ä–∞–≤–∏–ª–∞: `.aidd/CLAUDE.md` ‚Üí "–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ /aidd-*"

# –ö–æ–º–∞–Ω–¥–∞: /research

> –ó–∞–ø—É—Å–∫–∞–µ—Ç –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π.
> **Pipeline State v2**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –ø–∞–π–ø–ª–∞–π–Ω–æ–≤.

---

## –°–∏–Ω—Ç–∞–∫—Å–∏—Å

```bash
/research
```

---

## –û–ø–∏—Å–∞–Ω–∏–µ

–ö–æ–º–∞–Ω–¥–∞ `/aidd-research` –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∞–Ω–∞–ª–∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞ (–¥–ª—è FEATURE)
–∏–ª–∏ –∞–Ω–∞–ª–∏–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π (–¥–ª—è CREATE).

> **VERIFY BEFORE ACT**: –ü–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º —Ñ–∞–π–ª–æ–≤/–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∏—Ö
> —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ (—Å–º. CLAUDE.md, —Ä–∞–∑–¥–µ–ª "–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞").

---

## –ê–≥–µ–Ω—Ç

**–ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å** (`.claude/agents/researcher.md`)

---

## –ü–æ—Ä—è–¥–æ–∫ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤

> **–ü—Ä–∏–Ω—Ü–∏–ø**: –°–Ω–∞—á–∞–ª–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç –¶–ü, –ø–æ—Ç–æ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞.
> **–ü–æ–¥—Ä–æ–±–Ω–µ–µ**: [docs/initialization.md](../../docs/initialization.md)

### –§–∞–∑–∞ 1: –ö–æ–Ω—Ç–µ–∫—Å—Ç —Ü–µ–ª–µ–≤–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞

| # | –§–∞–π–ª | –£—Å–ª–æ–≤–∏–µ | –ó–∞—á–µ–º |
|---|------|---------|-------|
| 1 | `./CLAUDE.md` | –ï—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç | –°–ø–µ—Ü–∏—Ñ–∏–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ |
| 2 | `./.pipeline-state.json` | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ | –†–µ–∂–∏–º, —ç—Ç–∞–ø, –≤–æ—Ä–æ—Ç–∞ |
| 3 | `./ai-docs/docs/prd/*.md` | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ | PRD –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ |
| 4 | `./services/` | –î–ª—è FEATURE | –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ |

### –§–∞–∑–∞ 2: –ê–≤—Ç–æ–º–∏–≥—Ä–∞—Ü–∏—è –∏ –ø—Ä–µ–¥—É—Å–ª–æ–≤–∏—è

> **–í–∞–∂–Ω–æ**: –ü–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –∫–æ–º–∞–Ω–¥—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Ä—Å–∏—é `.pipeline-state.json`
> –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é v1 ‚Üí v2 –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è (—Å–º. `knowledge/pipeline/automigration.md`).

| –í–æ—Ä–æ—Ç–∞ | –ü—Ä–æ–≤–µ—Ä–∫–∞ (v2) |
|--------|---------------|
| `PRD_READY` | `active_pipelines[FID].gates.PRD_READY.passed == true` |

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ v2**: FID –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ —Ç–µ–∫—É—â–µ–π git –≤–µ—Ç–∫–µ.

### –§–∞–∑–∞ 3: –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞

| # | –§–∞–π–ª | –ó–∞—á–µ–º |
|---|------|-------|
| 5 | `.aidd/CLAUDE.md` | –ü—Ä–∞–≤–∏–ª–∞ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞ |
| 6 | `.aidd/workflow.md` | –ü—Ä–æ—Ü–µ—Å—Å –∏ –≤–æ—Ä–æ—Ç–∞ |
| 7 | `.aidd/.claude/commands/research.md` | –≠—Ç–æ—Ç —Ñ–∞–π–ª |
| 8 | `.aidd/.claude/agents/researcher.md` | –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —Ä–æ–ª–∏ |

### –§–∞–∑–∞ 4: –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π

| # | –§–∞–π–ª | –£—Å–ª–æ–≤–∏–µ |
|---|------|---------|
| 9 | `.aidd/knowledge/architecture/*.md` | –ü–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ |

---

## –†–µ–∂–∏–º—ã

| –†–µ–∂–∏–º | –ü–æ–≤–µ–¥–µ–Ω–∏–µ |
|-------|-----------|
| **CREATE** | –ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∏–∑ PRD, –≤—ã–±–æ—Ä —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π |
| **FEATURE** | –ê–Ω–∞–ª–∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞, –≤—ã—è–≤–ª–µ–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ |

---

## –ü—Ä–µ–¥—É—Å–ª–æ–≤–∏—è

| –í–æ—Ä–æ—Ç–∞ | –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ |
|--------|------------|
| `PRD_READY` | PRD –¥–æ–∫—É–º–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å |

### –ê–ª–≥–æ—Ä–∏—Ç–º –ø—Ä–æ–≤–µ—Ä–∫–∏ (v2)

```python
def check_research_preconditions() -> tuple[str, dict] | None:
    """
    –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–µ–¥—É—Å–ª–æ–≤–∏—è –¥–ª—è /research.

    v2: –û–ø—Ä–µ–¥–µ–ª—è–µ–º FID –ø–æ git –≤–µ—Ç–∫–µ, –ø—Ä–æ–≤–µ—Ä—è–µ–º active_pipelines[fid].gates
    """
    # 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å state
    state = ensure_v2_state()  # —Å–º. knowledge/pipeline/automigration.md
    if not state:
        print("‚ùå –ü–∞–π–ø–ª–∞–π–Ω –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω ‚Üí /aidd-idea")
        return None

    # 2. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å FID –ø–æ —Ç–µ–∫—É—â–µ–π git –≤–µ—Ç–∫–µ
    fid, pipeline = get_current_feature_context(state)
    if not fid:
        print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ñ–∏—á–∏")
        return None

    # 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å PRD_READY
    if not pipeline["gates"].get("PRD_READY", {}).get("passed"):
        print(f"‚ùå –í–æ—Ä–æ—Ç–∞ PRD_READY –Ω–µ –ø—Ä–æ–π–¥–µ–Ω—ã –¥–ª—è {fid}")
        print("   ‚Üí –°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ /aidd-idea")
        return None

    print(f"‚úì –§–∏—á–∞ {fid}: {pipeline.get('title')}")
    return (fid, pipeline)
```

---

## –í—ã—Ö–æ–¥–Ω—ã–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã

| –ê—Ä—Ç–µ—Ñ–∞–∫—Ç | –ü—É—Ç—å (v2) | –ü—É—Ç—å (v3) |
|----------|-----------|-----------|
| Research Report | `ai-docs/docs/research/{YYYY-MM-DD}_{FID}_{slug}-research.md` | `ai-docs/docs/_research/{YYYY-MM-DD}_{FID}_{slug}.md` |

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ (v2.4+)**:
> - **v2** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é): –°—Ç–∞—Ä–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `research/`, –∏–º—è —Å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º `{name}-research.md`
> - **v3** (–ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏): –ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `_research/`, –∏–º—è –±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è `{name}.md`
> - –†–µ–∂–∏–º –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∏–∑ `.pipeline-state.json ‚Üí naming_version`

### –ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞

FID –∏ slug –±–µ—Ä—É—Ç—Å—è –∏–∑ `active_pipelines[FID]` –≤ `.pipeline-state.json` (v2):

```python
# –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ state (v2)
fid, pipeline = get_current_feature_context(state)
if not fid:
    print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ñ–∏—á–∏")
    return None

slug = pipeline["name"]  # table-booking
date = datetime.now().strftime("%Y-%m-%d")  # 2024-12-23

# –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å naming_version –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤
naming_version = state.get("naming_version", "v2")

if naming_version == "v3":
    folder = "_research"
    filename = f"{date}_{fid}_{slug}.md"  # –ë–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
else:
    folder = "research"
    filename = f"{date}_{fid}_{slug}-research.md"  # –° –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º

artifact_path = f"{folder}/{filename}"
# v2: research/2024-12-23_F001_table-booking-research.md
# v3: _research/2024-12-23_F001_table-booking.md
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ .pipeline-state.json

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç—á—ë—Ç–∞ –æ–±–Ω–æ–≤–∏—Ç—å `active_pipelines[FID].artifacts` (v2):

**–ü—Ä–∏–º–µ—Ä –¥–ª—è v2 (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)**:
```json
{
  "naming_version": "v2",
  "active_pipelines": {
    "F001": {
      "branch": "feature/F001-table-booking",
      "name": "table-booking",
      "title": "–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–æ–ª–∏–∫–æ–≤",
      "stage": "RESEARCH",
      "gates": {
        "PRD_READY": {"passed": true, "passed_at": "2024-12-23T10:00:00Z"},
        "RESEARCH_DONE": {"passed": false}
      },
      "artifacts": {
        "prd": "prd/2024-12-23_F001_table-booking-prd.md",
        "research": "research/2024-12-23_F001_table-booking-research.md"
      }
    }
  }
}
```

**–ü—Ä–∏–º–µ—Ä –¥–ª—è v3 (–ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏)**:
```json
{
  "naming_version": "v3",
  "active_pipelines": {
    "F001": {
      "artifacts": {
        "prd": "_analysis/2024-12-23_F001_table-booking.md",
        "research": "_research/2024-12-23_F001_table-booking.md"
      }
    }
  }
}
```

---

## –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤–æ—Ä–æ—Ç–∞

### RESEARCH_DONE

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|
| –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞ | –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –∏–∑—É—á–µ–Ω (–¥–ª—è FEATURE) |
| –ü–∞—Ç—Ç–µ—Ä–Ω—ã | –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –≤—ã—è–≤–ª–µ–Ω—ã |
| –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è | –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã |
| –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ | –°—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞–Ω—ã —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ |
| –§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω—ë–Ω | –û—Ç—á—ë—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ø–∞–ø–∫–µ:<br>v2: `research/{YYYY-MM-DD}_{FID}_{slug}-research.md`<br>v3: `_research/{YYYY-MM-DD}_{FID}_{slug}.md` |

---

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```bash
# –ü–æ—Å–ª–µ /idea
/research
```

---

## –ß–µ–∫–ª–∏—Å—Ç –≤–æ—Ä–æ—Ç RESEARCH_DONE

> ‚ö†Ô∏è AI –û–ë–Ø–ó–ê–ù —Å–æ–∑–¥–∞—Ç—å TodoWrite —Å —ç—Ç–∏–º–∏ –ø—É–Ω–∫—Ç–∞–º–∏.

- [ ] üî¥ Research –æ—Ç—á—ë—Ç —Å–æ–∑–¥–∞–Ω –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ø–∞–ø–∫–µ:
  - v2: `ai-docs/docs/research/{name}-research.md`
  - v3: `ai-docs/docs/_research/{name}.md`
- [ ] üî¥ –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
- [ ] üî¥ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã
- [ ] üî¥ `.pipeline-state.json` –æ–±–Ω–æ–≤–ª—ë–Ω (gate: RESEARCH_DONE, artifact path —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç naming_version)
- [ ] üü° –†–∏—Å–∫–∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã
- [ ] üü° –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –æ–ø–∏—Å–∞–Ω—ã

---

## –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥

–ü–æ—Å–ª–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –≤–æ—Ä–æ—Ç `RESEARCH_DONE`:

```bash
/plan          # –¥–ª—è CREATE
/feature-plan  # –¥–ª—è FEATURE
```
