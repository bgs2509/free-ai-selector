# =============================================================================
# Free AI Selector - Docker Compose VPS Override
# =============================================================================
# Используется для VPS/production окружения за внешним nginx reverse proxy.
#
# Запуск:
#   docker compose -f docker-compose.yml -f docker-compose.vps.yml up -d
#   или: make vps
#
# Что добавляет к базовому docker-compose.yml:
# - Подключение Business API к внутренней и внешней сети для nginx
# - Определение proxy-network как external
#
# Порты API НЕ публикуются: доступ только через nginx reverse proxy.
# ROOT_PATH берётся из .env (${ROOT_PATH:-} / ${DATA_API_ROOT_PATH:-}).
# =============================================================================

services:
  # Подключаем Business API к Docker-сетям:
  # - free-ai-selector-network: связь с Data API и другими сервисами
  # - proxy-network: маршрутизация через внешний nginx reverse proxy
  #
  # В базовом docker-compose.yml networks не указаны для business-api,
  # т.к. в local-режиме используется network_mode: host (для VPN).
  free-ai-selector-business-api:
    networks:
      - free-ai-selector-network
      - proxy-network

# External сеть, создаётся и управляется внешним nginx-proxy контейнером.
# На VPS должна существовать до запуска: docker network create proxy-network
networks:
  proxy-network:
    external: true
