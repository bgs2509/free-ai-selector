# =============================================================================
# Free AI Selector - Docker Compose Override (локальная разработка)
# =============================================================================
# Этот файл автоматически загружается при запуске `docker compose up`
# без явного указания -f флагов (стандартное поведение Docker Compose).
#
# Что добавляет к базовому docker-compose.yml:
# - Публикация порта Data API (8001) на host
# - network_mode: host для Business API (трафик через VPN хоста)
# - Пустой ROOT_PATH для прямого доступа к /docs и /health
#
# Для VPS/production используйте:
#   docker compose -f docker-compose.yml -f docker-compose.vps.yml up -d
# =============================================================================

services:
  # Публикуем порт Data API для локального доступа к /docs и /health.
  # http://localhost:8001/docs — OpenAPI документация Data API.
  free-ai-selector-data-postgres-api:
    ports:
      - "8001:8001"
    environment:
      # Пустой ROOT_PATH: http://localhost:8001/docs работает без префиксов.
      # Переопределяет ${DATA_API_ROOT_PATH:-} из базового файла.
      ROOT_PATH: ""

  # Business API работает в host network для маршрутизации через VPN хоста.
  # Порты не публикуются — контейнер слушает напрямую на host:8000.
  # http://localhost:8000/docs — OpenAPI документация Business API.
  free-ai-selector-business-api:
    network_mode: host
    environment:
      # Пустой ROOT_PATH: http://localhost:8000/docs работает без префиксов.
      ROOT_PATH: ""
      # Data API доступен через опубликованный порт на localhost (не Docker DNS).
      DATA_API_URL: http://localhost:8001

  # Telegram Bot на bridge-сети обращается к Business API на host через gateway.
  free-ai-selector-telegram-bot:
    extra_hosts:
      - "host.docker.internal:host-gateway"
    environment:
      BUSINESS_API_URL: http://host.docker.internal:8000
