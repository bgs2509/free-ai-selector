---
feature_id: "F019"
feature_name: "model-id-priority-fallback"
title: "Model ID Priority Selection with Fallback ‚Äî Research"
created: "2026-02-11"
author: "AI (Researcher)"
type: "research"
status: "RESEARCH_DONE"
version: 1
mode: "FEATURE"
related_features: [F010, F011-B, F012, F018]
services: [free-ai-selector-business-api]
prd_ref: "_analysis/2026-02-11_F019_model-id-priority-fallback.md"
findings_count: 12
---

# Research Report: F019 Model ID Priority with Fallback

**Feature ID**: F019
**–í–µ—Ä—Å–∏—è**: 1.0
**–î–∞—Ç–∞**: 2026-02-11
**–ê–≤—Ç–æ—Ä**: AI Agent (–ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å)
**–°—Ç–∞—Ç—É—Å**: RESEARCH_DONE

---

## 1. –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è

- **PRD**: `ai-docs/docs/_analysis/2026-02-11_F019_model-id-priority-fallback.md`
- **–†–µ–∂–∏–º**: FEATURE
- **–¶–µ–ª—å**: –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω—É—é –∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é `model_id` –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π pipeline –≤—ã–±–æ—Ä–∞ –º–æ–¥–µ–ª–∏ –±–µ–∑ –Ω–∞—Ä—É—à–µ–Ω–∏—è fallback-–ª–æ–≥–∏–∫–∏ F012.

---

## 2. –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ–¥–∞

### 2.1 API –∫–æ–Ω—Ç—Ä–∞–∫—Ç (`ProcessPromptRequest`)

**–§–∞–π–ª**: `services/free-ai-selector-business-api/app/api/v1/schemas.py`

–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:
- –µ—Å—Ç—å `prompt` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π);
- –µ—Å—Ç—å `system_prompt` –∏ `response_format` (F011-B);
- **–Ω–µ—Ç** –ø–æ–ª—è `model_id`.

–í—ã–≤–æ–¥:
- —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ —ç—Ç–æ–º —Ñ–∞–π–ª–µ;
- –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø—Ä–∏ `Optional[int]` + `gt=0`.

### 2.2 API endpoint (`POST /api/v1/prompts/process`)

**–§–∞–π–ª**: `services/free-ai-selector-business-api/app/api/v1/prompts.py`

–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:
- endpoint —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç `PromptRequest` –∏–∑ –≤—Ö–æ–¥–Ω–æ–≥–æ schema;
- –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è `prompt`, `system_prompt`, `response_format`;
- **model_id –Ω–µ –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è**.

–í—ã–≤–æ–¥:
- —Ç–æ—á–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –æ–¥–Ω–∞: –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä `PromptRequest(...)`.

### 2.3 Domain DTO (`PromptRequest`)

**–§–∞–π–ª**: `services/free-ai-selector-business-api/app/domain/models.py`

–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:
- `PromptRequest` —Å–æ–¥–µ—Ä–∂–∏—Ç `user_id`, `prompt_text`, `system_prompt`, `response_format`;
- **–Ω–µ—Ç** –ø–æ–ª—è `model_id`.

–í—ã–≤–æ–¥:
- –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ `model_id: Optional[int] = None` –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –≤—ã–∑–æ–≤—ã –∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ —Å —Ç–µ–∫—É—â–∏–º–∏ —Ç–µ—Å—Ç–∞–º–∏.

### 2.4 Core business logic (`ProcessPromptUseCase.execute`)

**–§–∞–π–ª**: `services/free-ai-selector-business-api/app/application/use_cases/process_prompt.py`

–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ pipeline:
1. `get_all_models(active_only=True, available_only=True, include_recent=True)`
2. `_filter_configured_models()`
3. —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ `effective_reliability_score`
4. –ø–µ—Ä–µ–±–æ—Ä –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π —Å retry/fallback (F012)
5. –∑–∞–ø–∏—Å—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏/–∏—Å—Ç–æ—Ä–∏–∏

–ö–ª—é—á–µ–≤–æ–µ:
- fallback —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∏ —É—Å—Ç–æ–π—á–∏–≤;
- –≤—Å—è –ª–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∞ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ;
- —Ç–µ–∫—É—â–∞—è –ª–æ–≥–∏–∫–∞ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç forced-first –º–æ–¥–µ–ª—å.

### 2.5 Data API –∫–ª–∏–µ–Ω—Ç –∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã

**–§–∞–π–ª**: `services/free-ai-selector-business-api/app/infrastructure/http_clients/data_api_client.py`

–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:
- –µ—Å—Ç—å `get_all_models()`;
- –µ—Å—Ç—å `get_model_by_id()`;
- —Ç–µ–∫—É—â–∏–π use case –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ `get_all_models()`.

–í—ã–≤–æ–¥:
- –¥–ª—è F019 –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–µ–∫—É—â–µ–≥–æ `get_all_models()` (–±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö HTTP-–≤—ã–∑–æ–≤–æ–≤);
- `get_model_by_id()` –º–æ–∂–Ω–æ –Ω–µ –∑–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å, —á—Ç–æ–±—ã –Ω–µ —É—Å–ª–æ–∂–Ω—è—Ç—å –∏ –Ω–µ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é `available_only/configured`.

### 2.6 –ö–ª–∏–µ–Ω—Ç—ã endpoint

- Telegram bot (`services/free-ai-selector-telegram-bot/app/main.py`) –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ `{"prompt": ...}`.
- Web UI (`services/free-ai-selector-business-api/app/static/index.html`) —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç payload —Å `prompt/system_prompt/response_format`.

–í—ã–≤–æ–¥:
- –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –ø–æ–ª—è –Ω–µ –ª–æ–º–∞–µ—Ç —Ç–µ–∫—É—â–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤;
- UI –¥–ª—è –≤—ã–±–æ—Ä–∞ `model_id` –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –≤ —Ä–∞–º–∫–∞—Ö F019.

---

## 3. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### 3.1 –ü–∞—Ç—Ç–µ—Ä–Ω—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å

| –ü–∞—Ç—Ç–µ—Ä–Ω | –ì–¥–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω | –î–ª—è F019 |
|---------|-----------------|----------|
| HTTP-only data access | `DataAPIClient` | –°–æ—Ö—Ä–∞–Ω–∏—Ç—å, –±–µ–∑ –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –ë–î |
| Provider SSOT | `ProviderRegistry.get_api_key_env()` | –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é configured-–º–æ–¥–µ–ª–µ–π |
| Full fallback loop | `ProcessPromptUseCase.execute` | –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–µ–º–∞–Ω—Ç–∏–∫–∏ |
| Sanitized logging | `sanitize_error_message()` | –ù–µ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ |

### 3.2 –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- –ù–µ–ª—å–∑—è –¥–æ–±–∞–≤–ª—è—Ç—å –ª–∏—à–Ω–∏–µ –≤–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏.
- –ù–µ–ª—å–∑—è –ª–æ–º–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –±–µ–∑ `model_id`.
- –ù–µ —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ Data API –≤—ã–∑–æ–≤–æ–≤ –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.
- –ù–µ –∏–∑–º–µ–Ω—è—Ç—å Data API schema/endpoint –¥–ª—è —ç—Ç–æ–π —Ñ–∏—á–∏.

---

## 4. –í–∞—Ä–∏–∞–Ω—Ç—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤—ã–±–æ—Ä–∞ forced –º–æ–¥–µ–ª–∏

### –í–∞—Ä–∏–∞–Ω—Ç A (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π): in-memory reorder —Å–ø–∏—Å–∫–∞

–ê–ª–≥–æ—Ä–∏—Ç–º:
1. –ø–æ–ª—É—á–∏—Ç—å `configured_models` –∫–∞–∫ —Å–µ–π—á–∞—Å;
2. –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ `effective_reliability_score`;
3. –µ—Å–ª–∏ `request.model_id` –∑–∞–¥–∞–Ω:
   - –Ω–∞–π—Ç–∏ –º–æ–¥–µ–ª—å –≤ —ç—Ç–æ–º –∂–µ —Å–ø–∏—Å–∫–µ;
   - –µ—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–∞: —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å `candidate_models = [requested] + others_without_requested`;
   - –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞: –æ—Å—Ç–∞–≤–∏—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–π `sorted_models`;
4. –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π fallback loop –ø–æ `candidate_models`.

–ü–ª—é—Å—ã:
- 0 –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö HTTP –≤—ã–∑–æ–≤–æ–≤;
- reuse —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ª–æ–≥–∏–∫–∏ availability/configuration;
- –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞.

–ú–∏–Ω—É—Å—ã:
- –ø–æ–∏—Å–∫ requested –º–æ–¥–µ–ª–∏ –ª–∏–Ω–µ–π–Ω—ã–π O(n), –Ω–æ n –º–∞–ª (—Å–ø–∏—Å–æ–∫ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω).

### –í–∞—Ä–∏–∞–Ω—Ç B: –æ—Ç–¥–µ–ª—å–Ω—ã–π fetch `get_model_by_id` + merge

–ü–ª—é—Å—ã:
- —è–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –º–æ–¥–µ–ª–∏ –ø–æ ID.

–ú–∏–Ω—É—Å—ã:
- –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π HTTP –≤—ã–∑–æ–≤;
- –Ω—É–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å availability/configuration;
- –ø–æ–≤—ã—à–∞–µ—Ç—Å—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å –∏ —Ä–∏—Å–∫ —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ª–æ–≥–∏–∫–∏.

**–†–µ—à–µ–Ω–∏–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è**: –≤—ã–±—Ä–∞—Ç—å **–í–∞—Ä–∏–∞–Ω—Ç A** (KISS/YAGNI).

---

## 5. –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–æ —Ñ–∞–π–ª–∞–º

### 5.1 –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

| –§–∞–π–ª | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|------|-----------|
| `services/free-ai-selector-business-api/app/api/v1/schemas.py` | –¥–æ–±–∞–≤–∏—Ç—å `model_id: Optional[int] = Field(None, gt=0, description=...)` |
| `services/free-ai-selector-business-api/app/domain/models.py` | –¥–æ–±–∞–≤–∏—Ç—å `model_id: Optional[int] = None` –≤ `PromptRequest` |
| `services/free-ai-selector-business-api/app/api/v1/prompts.py` | –ø—Ä–æ–±—Ä–æ—Å–∏—Ç—å `model_id=prompt_data.model_id` |
| `services/free-ai-selector-business-api/app/application/use_cases/process_prompt.py` | –¥–æ–±–∞–≤–∏—Ç—å —Å–±–æ—Ä–∫—É `candidate_models` —Å forced-first –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –≤–∞–ª–∏–¥–Ω–æ–π –º–æ–¥–µ–ª–∏ |

### 5.2 –¢–µ—Å—Ç—ã

| –§–∞–π–ª | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|------|-----------|
| `services/free-ai-selector-business-api/tests/unit/test_f011b_schemas.py` | –ø—Ä–æ–≤–µ—Ä–∏—Ç—å schema/DTO —Å `model_id` –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—é `gt=0` |
| `services/free-ai-selector-business-api/tests/unit/test_process_prompt_use_case.py` | –¥–æ–±–∞–≤–∏—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–∏ forced-first / missing model_id / forced failure fallback |

### 5.3 –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (–≤–Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–≥–æ scope)

| –§–∞–π–ª | –°—Ç–∞—Ç—É—Å |
|------|--------|
| `services/free-ai-selector-business-api/app/static/index.html` | optional: UI –≤—ã–±–æ—Ä–∞ `model_id` |
| `services/free-ai-selector-telegram-bot/app/main.py` | optional: –ø–µ—Ä–µ–¥–∞—á–∞ `model_id` |

---

## 6. –ê–Ω–∞–ª–∏–∑ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∫—Ä—ã—Ç–∏—è –∏ gaps

### 6.1 –ß—Ç–æ —É–∂–µ –µ—Å—Ç—å

- unit-—Ç–µ—Å—Ç—ã schema –¥–ª—è F011-B (`test_f011b_schemas.py`);
- unit-—Ç–µ—Å—Ç—ã fallback/retry –ø–æ–≤–µ–¥–µ–Ω–∏—è use case (`test_process_prompt_use_case.py`, `test_f012_rate_limit_handling.py`);
- smoke/unit —Å—Ü–µ–Ω–∞—Ä–∏–∏ –±–µ–∑ `model_id`.

### 6.2 –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–ª—è F019

| ID | –¢–µ—Å—Ç | –¶–µ–ª—å |
|----|------|------|
| T-001 | schema accepts `model_id` | —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ |
| T-002 | schema rejects `model_id <= 0` | –≤–∞–ª–∏–¥–∞—Ü–∏—è –≥—Ä–∞–Ω–∏—Ü |
| T-003 | forced model selected first | —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å FR-003 |
| T-004 | missing forced model falls back | —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å FR-004 |
| T-005 | forced model error triggers fallback | —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å FR-005 |
| T-006 | no model_id regression | –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å FR-006 |
| T-007 | system_prompt/response_format preserved in forced+fallback | FR-012 |

### 6.3 Integration gap

- –í —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –Ω–µ—Ç —è–≤–Ω—ã—Ö integration —Ç–µ—Å—Ç–æ–≤ –¥–ª—è `POST /prompts/process` —Å —Ä–µ–∞–ª—å–Ω—ã–º Data API stub.
- –î–ª—è F019 —Å—Ç–æ–∏—Ç –¥–æ–±–∞–≤–∏—Ç—å –º–∏–Ω–∏–º—É–º 1 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –Ω–∞ —à–∞–≥–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏/–≤–∞–ª–∏–¥–∞—Ü–∏–∏.

---

## 7. Quality Cascade Checklist (7/7)

### QC-1: DRY ‚úÖ
- [x] –í—ã—è–≤–ª–µ–Ω —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π fallback loop –≤ `process_prompt.py`.
- [x] –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–æ–≤–æ–π –≤–µ—Ç–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏.
- [x] –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –Ω–æ–≤—ã–π use case/service.

### QC-2: KISS ‚úÖ
- [x] –í—ã–±—Ä–∞–Ω in-memory reorder –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ (—Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π –ø—É—Ç—å).
- [x] –û—Ç–∫–∞–∑ –æ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ `get_model_by_id` HTTP –∑–∞–ø—Ä–æ—Å–∞.
- [x] –ò–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤ 4 production —Ñ–∞–π–ª–∞—Ö.

### QC-3: YAGNI ‚úÖ
- [x] –ò—Å–∫–ª—é—á–µ–Ω—ã –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è UI/–±–æ—Ç–∞ –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ scope.
- [x] `FR-020 used_fallback` –æ—Å—Ç–∞–≤–ª–µ–Ω –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º, –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é.
- [x] –ù–µ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –Ω–æ–≤—ã–µ endpoint/DTO —Å–≤–µ—Ä—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.

### QC-4: SoC ‚úÖ
- [x] API schema, route, domain DTO –∏ use case –∏–∑–º–µ–Ω—è—é—Ç—Å—è –≤ —Å–≤–æ–∏—Ö —Å–ª–æ—è—Ö.
- [x] Data API –∫–æ–Ω—Ç—Ä–∞–∫—Ç –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è.
- [x] ProviderRegistry –∏ retry-—Å–µ—Ä–≤–∏—Å—ã –æ—Å—Ç–∞—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—è–º–∏.

### QC-5: SSoT ‚úÖ
- [x] –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π: `DataAPIClient.get_all_models()`.
- [x] –ò—Å—Ç–æ—á–Ω–∏–∫ configured-check: `ProviderRegistry.get_api_key_env()`.
- [x] –ù–µ—Ç –¥—É–±–ª–µ–π –ª–æ–≥–∏–∫–∏ availability/configuration –≤ –Ω–æ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö.

### QC-6: CoC ‚úÖ
- [x] –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è `Optional[int]`, `Field(gt=0)` –∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Å—Ç–∏–ª—å type hints.
- [x] –°–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–º—É —Å—Ç–∏–ª—é –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (`log_decision`, structured fields).
- [x] –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Ç–µ–∫—É—â–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —à–∞–≥–æ–≤ use case.

### QC-7: Security ‚úÖ
- [x] –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤ –≤ –Ω–æ–≤–æ–º –ø–æ–ª–µ `model_id`.
- [x] –õ–æ–≥–∏ –¥–æ–ª–∂–Ω—ã —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã (`model_id`, `provider`, `reason`).
- [x] –û—à–∏–±–∫–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç—å —á–µ—Ä–µ–∑ `sanitize_error_message()`.

---

## 8. –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏–∏

| # | –†–∏—Å–∫ | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å | –í–ª–∏—è–Ω–∏–µ | –ú–∏—Ç–∏–≥–∞—Ü–∏—è |
|---|------|-------------|---------|-----------|
| 1 | requested model –µ—Å—Ç—å –≤ –ë–î, –Ω–æ –Ω–µ configured/available | Medium | Medium | fallback –Ω–∞ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫, –±–µ–∑ 5xx |
| 2 | –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ requested –º–æ–¥–µ–ª–∏ –≤ candidate list | Low | Medium | —è–≤–Ω–∞—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ `model.id` |
| 3 | —Ä–µ–≥—Ä–µ—Å—Å–∏—è —Ç–µ–∫—É—â–µ–≥–æ –≤—ã–±–æ—Ä–∞ –±–µ–∑ `model_id` | Low | High | –æ—Ç–¥–µ–ª—å–Ω—ã–π regression test T-006 |
| 4 | –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å forced/fallback | Medium | Low | –¥–æ–±–∞–≤–∏—Ç—å structured decision logs (`selection_mode`, `requested_model_id`, `requested_model_found`) |

---

## 9. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —ç—Ç–∞–ø–∞ `/aidd-plan-feature`

1. –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è `candidate_models` –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø—Ä–∏–≤–∞—Ç–Ω—ã–π helper –≤ use case.
2. –Ø–≤–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –∑–∞–ø–∏—Å–∏ failure history, –µ—Å–ª–∏ forced –º–æ–¥–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–≤—ã–π —Ä–µ–∞–ª—å–Ω–æ –ø–æ–ø—Ä–æ–±–æ–≤–∞–Ω–Ω—ã–π candidate).
3. –û—Ç–¥–µ–ª—å–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å policy –¥–ª—è `model_id` –ø—Ä–∏ rate-limit (429):
   - forced –º–æ–¥–µ–ª—å —É—Ö–æ–¥–∏—Ç –≤ cooldown;
   - –¥–∞–ª—å–Ω–µ–π—à–∏–µ –∫–∞–Ω–¥–∏–¥–∞—Ç—ã –∏–¥—É—Ç –ø–æ –æ–±—ã—á–Ω–æ–º—É F012 pipeline.
4. –í –ø–ª–∞–Ω–µ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ—Ç—å –º–∏–Ω–∏–º—É–º 7 unit —Ç–µ—Å—Ç–æ–≤ (T-001..T-007).

---

## 10. –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤–æ—Ä–æ—Ç–∞ RESEARCH_DONE

- [x] üî¥ Research –æ—Ç—á—ë—Ç —Å–æ–∑–¥–∞–Ω –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ø–∞–ø–∫–µ: `ai-docs/docs/_research/2026-02-11_F019_model-id-priority-fallback.md`
- [x] üî¥ –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
- [x] üî¥ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã
- [x] üî¥ `.pipeline-state.json` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–±–Ω–æ–≤–ª—ë–Ω (gate: RESEARCH_DONE, artifact path v3)
- [x] üü° –†–∏—Å–∫–∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã
- [x] üü° –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –æ–ø–∏—Å–∞–Ω—ã

---

## 11. –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥

```bash
/aidd-plan-feature
```
