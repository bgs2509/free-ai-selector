# Шаблон итогового отчёта по нагрузочному тестированию

**Дата прогона**: `<YYYY-MM-DD>`  
**Тестовый контур**: `<local/stage/prod-like>`  
**Версия/коммит**: `<git-sha>`  
**Инструмент**: `Locust`  
**Сценарии**: `baseline`, `ramp_up`, `sustained`, `failover`  
**Исполнитель**: `<name>`

---

## 1. Краткое резюме

### 1.1 Итог по целям

| Цель | Статус | Комментарий |
|---|---|---|
| Найти точку деградации | `<DONE/FAILED/PARTIAL>` | `<users/rps/error-rate-threshold>` |
| Проверить каскадный отказ | `<DONE/FAILED/PARTIAL>` | `<наблюдался/не наблюдался>` |
| Проверить failover между провайдерами | `<DONE/FAILED/PARTIAL>` | `<attempts/fallback_used>` |
| Оценить восстановление после снижения нагрузки | `<DONE/FAILED/PARTIAL>` | `<время восстановления>` |

### 1.2 Сводные метрики

| Метрика | Значение |
|---|---|
| Всего запросов | `<int>` |
| Успешно | `<int (% )>` |
| Ошибки | `<int (% )>` |
| Средний RPS | `<float>` |
| p50 latency | `<ms>` |
| p95 latency | `<ms>` |
| p99 latency | `<ms>` |
| Max latency | `<ms>` |
| Точка деградации (`error_rate > 10%`) | `<users/rps/время>` |

---

## 2. Конфигурация теста

### 2.1 Параметры запуска Locust

| Параметр | Значение |
|---|---|
| Host | `<http://...>` |
| Пользователи (`--users`) | `<int>` |
| Скорость спауна (`--spawn-rate`) | `<float>` |
| Время прогона (`--run-time`) | `<10m/...>` |
| Сценарий (`LOCUST_SCENARIO`) | `<baseline/ramp_up/sustained/failover>` |
| API prefix | `< /api/v1 / ... >` |
| Таймаут запроса | `<sec>` |
| Мониторинговые запросы (`ENABLE_MONITORING`) | `<true/false>` |
| Oversize prompt (`INCLUDE_OVERSIZE_PROMPT`) | `<true/false>` |

### 2.2 Окружение

| Компонент | Версия/сборка | Примечание |
|---|---|---|
| Business API | `<version>` | `<container/image>` |
| Data API | `<version>` | `<container/image>` |
| PostgreSQL | `<version>` | `<container/image>` |
| Кол-во активных моделей | `<int>` | `<из /api/v1/models/stats>` |

### 2.3 Источники данных

- JSONL результаты Locust: `<path>`  
- CSV/HTML отчёты Locust (если использовались): `<path>`  
- Логи Business API: `<path/command>`  
- Логи Data API: `<path/command>`

---

## 3. Результаты по сценариям

## 3.1 Baseline

| Показатель | Значение |
|---|---|
| Длительность | `<time>` |
| Пользователи | `<int>` |
| RPS | `<float>` |
| Success rate | `<%>` |
| Failure rate | `<%>` |
| p50/p95/p99 | `<ms/ms/ms>` |
| Основные коды ошибок | `<list>` |

**Наблюдения**:  
`<текст>`

## 3.2 Ramp-up

| Шаг | Пользователи | RPS | Error rate | p95 | Комментарий |
|---|---:|---:|---:|---:|---|
| 1 | `<int>` | `<float>` | `<%>` | `<ms>` | `<...>` |
| 2 | `<int>` | `<float>` | `<%>` | `<ms>` | `<...>` |
| 3 | `<int>` | `<float>` | `<%>` | `<ms>` | `<...>` |

**Точка деградации**: `<описание>`  
**Наблюдения**: `<текст>`

## 3.3 Sustained (10 минут)

| Показатель | Значение |
|---|---|
| Фиксированная нагрузка | `<users/rps>` |
| Success rate | `<%>` |
| Failure rate | `<%>` |
| p50/p95/p99 | `<ms/ms/ms>` |
| Серии непрерывных ошибок (max) | `<int>` |

**Каскадный отказ**: `<да/нет + детали>`  
**Наблюдения**: `<текст>`

## 3.4 Provider failover

| Метрика | Значение |
|---|---|
| Среднее `attempts` | `<float>` |
| p95 `attempts` | `<int>` |
| Доля `fallback_used=true` | `<%>` |
| Средняя latency успешных | `<ms>` |
| Средняя latency неуспешных | `<ms>` |
| Top провайдеры по ошибкам | `<provider:count>` |

**Overhead failover**: `<оценка>`  
**Наблюдения**: `<текст>`

## 3.5 Recovery (после снижения нагрузки)

| Показатель | Значение |
|---|---|
| Момент снижения нагрузки | `<timestamp>` |
| Время до `error_rate < 10%` | `<sec/min>` |
| Время до стабильного p95 | `<sec/min>` |
| Восстановление `/health` | `<ok/not-ok>` |

---

## 4. Анализ ошибок

### 4.1 По HTTP-кодам

| Код | Кол-во | Доля | Комментарий |
|---|---:|---:|---|
| 422 | `<int>` | `<%>` | `<payload/validation>` |
| 429 | `<int>` | `<%>` | `<rate limit/backpressure>` |
| 500 | `<int>` | `<%>` | `<internal/all models failed>` |
| 503 | `<int>` | `<%>` | `<service unavailable>` |
| Other | `<int>` | `<%>` | `<...>` |

### 4.2 По провайдерам (из telemetry)

| Провайдер | Ошибки | Успехи | Средняя latency | Комментарий |
|---|---:|---:|---:|---|
| `<name>` | `<int>` | `<int>` | `<ms>` | `<...>` |

### 4.3 Топ сообщений об ошибках

| Сообщение | Кол-во |
|---|---:|
| `<error text>` | `<int>` |

---

## 5. Деградация во времени

| Окно времени | Requests | Error rate | p95 | Основной тип ошибок |
|---|---:|---:|---:|---|
| `<t1-t2>` | `<int>` | `<%>` | `<ms>` | `<...>` |
| `<t2-t3>` | `<int>` | `<%>` | `<ms>` | `<...>` |

**Максимальная серия ошибок**: `<int>`  
**Комментарий по тренду**: `<текст>`

---

## 6. Проверка критериев приёмки

| Критерий | Порог | Факт | Статус |
|---|---|---|---|
| Общий error rate | `<= 20%` | `<%>` | `<PASS/FAIL>` |
| 422 на валидных payload | `0` | `<int>` | `<PASS/FAIL>` |
| Уход в 100% ошибок на sustained | `не допускается` | `<да/нет>` | `<PASS/FAIL>` |
| p95 latency | `<целевое значение>` | `<ms>` | `<PASS/FAIL>` |
| Повторные попытки по permanent-ошибкам | `минимум` | `<оценка>` | `<PASS/FAIL>` |

---

## 7. Сравнение с историческим прогоном 2026-02-24/25

| Метрика | Исторический baseline | Текущий прогон | Delta |
|---|---:|---:|---:|
| Ошибки (%) | `66.09%` | `<%>` | `<pp>` |
| HTTP 500 (%) | `94.25% от ошибок` | `<%>` | `<pp>` |
| HTTP 422 (шт) | `139` | `<int>` | `<int>` |
| Max непрерывная серия ошибок | `266` | `<int>` | `<int>` |
| Max latency | `41184 ms` | `<ms>` | `<ms>` |

---

## 8. Выводы и действия

### 8.1 Основные выводы

1. `<вывод 1>`
2. `<вывод 2>`
3. `<вывод 3>`

### 8.2 Приоритизированный план действий

| Приоритет | Действие | Владелец | Срок |
|---|---|---|---|
| P0 | `<...>` | `<...>` | `<date>` |
| P1 | `<...>` | `<...>` | `<date>` |
| P2 | `<...>` | `<...>` | `<date>` |

---

## 9. Приложения

- Команды запуска Locust:  
`<command>`

- Сырые файлы:  
`<paths>`

- Графики/скриншоты:  
`<links or paths>`
