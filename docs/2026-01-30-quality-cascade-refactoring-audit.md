# Quality Cascade Refactoring Audit

> **–ü—Ä–æ–µ–∫—Ç**: Free AI Selector
> **–î–∞—Ç–∞**: 2026-01-30
> **–ê—É–¥–∏—Ç–æ—Ä**: Claude Code (Opus 4.5)
> **–ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è**: Quality Cascade v2 (QC-1...QC-17)

---

## Executive Summary

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| **–í—Å–µ–≥–æ –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ** | 17 |
| **PASS** | 8 |
| **PARTIAL** | 7 |
| **FAIL** | 2 |
| **BLOCKED (AIDD)** | 0 |
| **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º (P0)** | 3 |
| **–û—Å–Ω–æ–≤–Ω–æ–π impact** | ~1,400 —Å—Ç—Ä–æ–∫ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –≤ AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞—Ö |

---

## –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –æ—Ü–µ–Ω–æ–∫

| QC | –ü—Ä–∏–Ω—Ü–∏–ø | –û—Ü–µ–Ω–∫–∞ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|----|---------|--------|-----------|
| QC-1 | DRY | **FAIL** | P0 |
| QC-2 | KISS | PARTIAL | P1 |
| QC-3 | YAGNI | PASS | ‚Äî |
| QC-4 | SRP | PARTIAL | P1 |
| QC-5 | OCP | PASS | ‚Äî |
| QC-6 | LSP | PARTIAL | P2 |
| QC-7 | ISP | PASS | ‚Äî |
| QC-8 | DIP | PARTIAL | P2 |
| QC-9 | SoC | PASS | ‚Äî |
| QC-10 | SSoT | PARTIAL | P2 |
| QC-11 | LoD | PASS | ‚Äî |
| QC-12 | CoC | PASS | ‚Äî |
| QC-13 | Fail Fast | PARTIAL | P2 |
| QC-14 | Explicit | PASS | ‚Äî |
| QC-15 | Composition | **FAIL** | P0 |
| QC-16 | Testability | PARTIAL | P1 |
| QC-17 | Security | PASS | ‚Äî |

---

## QC-1: DRY (Don't Repeat Yourself)

**–¶–µ–ª—å:** –£—Å—Ç—Ä–∞–Ω–∏—Ç—å –¥—É–±–ª–∏ –ª–æ–≥–∏–∫–∏/—Å—Ç—Ä—É–∫—Ç—É—Ä –∏ —Å–≤–µ—Å—Ç–∏ –ø–æ–≤—Ç–æ—Ä –∫ –æ–±—â–∏–º –ø—Ä–∏–º–∏—Ç–∏–≤–∞–º.

**–ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:**
- [x] –ü–æ–≤—Ç–æ—Ä—ã –ª–æ–≥–∏–∫–∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã (–≤–Ω—É—Ç—Ä–∏ —Ñ–∞–π–ª–∞ –∏ –º–µ–∂–¥—É —Ñ–∞–π–ª–∞–º–∏/—Å–µ—Ä–≤–∏—Å–∞–º–∏)
- [ ] –ü–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã –æ–±—ä–µ–¥–∏–Ω–µ–Ω—ã —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏–∏/–º–µ—Ç–æ–¥—ã/—É—Ç–∏–ª–∏—Ç—ã
- [ ] –ü–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —Å—Ö–µ–º—ã –¥–∞–Ω–Ω—ã—Ö/DTO –Ω–µ —Ä–∞–∑–º–Ω–æ–∂–∞—é—Ç—Å—è
- [ ] –ù–µ—Ç "–ø–æ—á—Ç–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö" —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π (–≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ ‚Äî –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏—è)
- [x] ‚ö†Ô∏è AIDD: –û–±—â–∏–π –∫–æ–¥ –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏ –¥–æ–ø—É—Å—Ç–∏–º –¢–û–õ–¨–ö–û —á–µ—Ä–µ–∑ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ (–Ω–µ –æ–±—â–∏–µ –º–æ–¥—É–ª–∏)

**–ö—Ä–∏—Ç–µ—Ä–∏–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è:** –û–¥–∏–Ω–∞–∫–æ–≤–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∞ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ.

**–ù–∞–π–¥–µ–Ω–æ –≤ –∫–æ–¥–µ:**

‚ùå **–ù–∞—Ä—É—à–µ–Ω–∏–µ #1: –ú–∞—Å—Å–∏–≤–Ω–æ–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞—Ö (~1,100 —Å—Ç—Ä–æ–∫)**
```
services/free-ai-selector-business-api/app/infrastructure/ai_providers/
‚îú‚îÄ‚îÄ groq.py          (143 —Å—Ç—Ä–æ–∫–∏) ‚îÄ‚îê
‚îú‚îÄ‚îÄ cerebras.py      (144 —Å—Ç—Ä–æ–∫–∏)  ‚îÇ
‚îú‚îÄ‚îÄ sambanova.py     (143 —Å—Ç—Ä–æ–∫–∏)  ‚îÇ
‚îú‚îÄ‚îÄ deepseek.py      (143 —Å—Ç—Ä–æ–∫–∏)  ‚îÇ 11 –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ —Å 95%
‚îú‚îÄ‚îÄ openrouter.py    (146 —Å—Ç—Ä–æ–∫–∏)  ‚îÇ –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–º –∫–æ–¥–æ–º
‚îú‚îÄ‚îÄ hyperbolic.py    (143 —Å—Ç—Ä–æ–∫–∏)  ‚îÇ
‚îú‚îÄ‚îÄ huggingface.py   (156 —Å—Ç—Ä–æ–∫)   ‚îÇ
‚îú‚îÄ‚îÄ github_models.py (148 —Å—Ç—Ä–æ–∫)   ‚îÇ
‚îú‚îÄ‚îÄ fireworks.py     (143 —Å—Ç—Ä–æ–∫–∏)  ‚îÇ
‚îú‚îÄ‚îÄ novita.py        (145 —Å—Ç—Ä–æ–∫)   ‚îÇ
‚îú‚îÄ‚îÄ kluster.py       (143 —Å—Ç—Ä–æ–∫–∏)  ‚îÇ
‚îú‚îÄ‚îÄ nebius.py        (143 —Å—Ç—Ä–æ–∫–∏)  ‚îÇ
‚îî‚îÄ‚îÄ scaleway.py      (144 —Å—Ç—Ä–æ–∫–∏) ‚îÄ‚îò
```

–î—É–±–ª–∏—Ä—É–µ–º—ã–π –∫–æ–¥ –≤ –∫–∞–∂–¥–æ–º –ø—Ä–æ–≤–∞–π–¥–µ—Ä–µ:
- `generate()` –º–µ—Ç–æ–¥: —Å—Ç—Ä–æ–∫–∏ 43-118 (~75 —Å—Ç—Ä–æ–∫)
- `health_check()` –º–µ—Ç–æ–¥: —Å—Ç—Ä–æ–∫–∏ 120-143 (~23 —Å—Ç—Ä–æ–∫–∏)
- –í–∞–ª–∏–¥–∞—Ü–∏—è API key
- Headers formation
- Payload building
- OpenAI-compatible response parsing

‚ùå **–ù–∞—Ä—É—à–µ–Ω–∏–µ #2: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ `_model_to_response()` –≤ Data API**
```
services/free-ai-selector-data-postgres-api/app/api/v1/models.py:
‚îú‚îÄ‚îÄ _model_to_response()      (—Å—Ç—Ä–æ–∫–∏ 334-370) ‚Äî 36 —Å—Ç—Ä–æ–∫
‚îî‚îÄ‚îÄ _model_to_response_with_recent() (—Å—Ç—Ä–æ–∫–∏ 421-462) ‚Äî 41 —Å—Ç—Ä–æ–∫
```
90% –∏–¥–µ–Ω—Ç–∏—á–Ω–æ–≥–æ –∫–æ–¥–∞, –æ—Ç–ª–∏—á–∏–µ —Ç–æ–ª—å–∫–æ –≤ `recent_*` –ø–æ–ª—è—Ö.

‚ùå **–ù–∞—Ä—É—à–µ–Ω–∏–µ #3: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ repository.get + HTTPException**
```
services/free-ai-selector-data-postgres-api/app/api/v1/models.py:
—Å—Ç—Ä–æ–∫–∏ 84-91, 117-125, 167-180, 207-216, 245-252, 277-284, 318-328
```
7 –º–µ—Å—Ç —Å –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–º –ø–∞—Ç—Ç–µ—Ä–Ω–æ–º "get_by_id + 404".

‚ö†Ô∏è **–†–∏—Å–∫ #4: –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ reliability_score –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è**
```
services/free-ai-selector-data-postgres-api/app/domain/models.py:70-80
services/free-ai-selector-data-postgres-api/app/api/v1/models.py:396-402
```

‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç: Shared utilities –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏**
```
services/*/app/utils/
‚îú‚îÄ‚îÄ logger.py            ‚îÄ‚îê
‚îú‚îÄ‚îÄ security.py           ‚îÇ –ò–¥–µ–Ω—Ç–∏—á–Ω—ã–µ –∫–æ–ø–∏–∏
‚îú‚îÄ‚îÄ sensitive_filter.py   ‚îÇ (–î–û–ü–£–°–¢–ò–ú–û –¥–ª—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤)
‚îî‚îÄ‚îÄ request_id.py        ‚îÄ‚îò
```
üîí AIDD CONSTRAINT: –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ utils –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏ ‚Äî –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ–≥–æ –¥–µ–ø–ª–æ—è.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É:**
1. **P0**: –°–æ–∑–¥–∞—Ç—å `OpenAICompatibleProvider` –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –≤ `base.py`
2. **P1**: –û–±—ä–µ–¥–∏–Ω–∏—Ç—å `_model_to_response()` —Ñ—É–Ω–∫—Ü–∏–∏ —Å optional –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º
3. **P1**: –°–æ–∑–¥–∞—Ç—å dependency `get_model_or_404(model_id, db)`
4. **P2**: –í—ã–Ω–µ—Å—Ç–∏ reliability calculation –≤ domain service

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P0
**–û—Ü–µ–Ω–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è:** **FAIL**

---

## QC-2: KISS (Keep It Simple, Stupid)

**–¶–µ–ª—å:** –£–ø—Ä–æ—Å—Ç–∏—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é, –∏—Å–∫–ª—é—á–∏—Ç—å over-engineering.

**–ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:**
- [ ] –°–ª–æ–∂–Ω—ã–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ –±–æ–ª–µ–µ –ø—Ä—è–º–æ–ª–∏–Ω–µ–π–Ω—ã–µ
- [ ] –£–±—Ä–∞–Ω—ã –ª–∏—à–Ω–∏–µ —É—Ä–æ–≤–Ω–∏ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏
- [ ] –£—Å–ª–æ–≤–∏—è –∏ –ø–æ—Ç–æ–∫–∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è —á–∏—Ç–∞—é—Ç—Å—è –ª–∏–Ω–µ–π–Ω–æ
- [x] ‚ö†Ô∏è AIDD: –ù–µ –¥–æ–±–∞–≤–ª—è—Ç—å –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ –¥–ª—è "–±—É–¥—É—â–µ–π —Ä–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç–∏"

**–ö—Ä–∏—Ç–µ—Ä–∏–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è:** –ö–ª—é—á–µ–≤–æ–π –º–æ–¥—É–ª—å/—Ñ—É–Ω–∫—Ü–∏—è –ø–æ–Ω–∏–º–∞–µ—Ç—Å—è –∑–∞ –æ–¥–∏–Ω –ø—Ä–æ—Ö–æ–¥ —á—Ç–µ–Ω–∏—è.

**–ù–∞–π–¥–µ–Ω–æ –≤ –∫–æ–¥–µ:**

‚ö†Ô∏è **–†–∏—Å–∫ #1: Over-engineered error handling –≤ process_prompt.py**
```
services/free-ai-selector-business-api/app/application/use_cases/process_prompt.py:177-301
```
5 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö except –±–ª–æ–∫–æ–≤ —Å –ø–æ—á—Ç–∏ –∏–¥–µ–Ω—Ç–∏—á–Ω–æ–π –ª–æ–≥–∏–∫–æ–π:
- `except RateLimitError` ‚Äî –ª–æ–≥–∏–∫–∞ A
- `except (ServerError, TimeoutError)` ‚Äî –ª–æ–≥–∏–∫–∞ B
- `except (AuthenticationError, ValidationError)` ‚Äî –ª–æ–≥–∏–∫–∞ B (–∏–¥–µ–Ω—Ç–∏—á–Ω–∞!)
- `except ProviderError` ‚Äî –ª–æ–≥–∏–∫–∞ B (–∏–¥–µ–Ω—Ç–∏—á–Ω–∞!)
- `except Exception` ‚Äî classify + –ª–æ–≥–∏–∫–∞ A –∏–ª–∏ B

**–¶–∏–∫–ª–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å `execute()`:** ~25-30 (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è < 10)

‚ö†Ô∏è **–†–∏—Å–∫ #2: `get_statistics_for_period()` –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ –∑–∞–ø–∏—Å–∏ –≤ –ø–∞–º—è—Ç—å**
```
services/free-ai-selector-data-postgres-api/app/infrastructure/repositories/prompt_history_repository.py:224-237
```
```python
histories = result.scalars().all()  # –ó–ê–ì–†–£–ñ–ê–ï–¢ –í–°–ï –ó–ê–ü–ò–°–ò!
total_requests = len(histories)     # Python loop –≤–º–µ—Å—Ç–æ SQL COUNT
```

‚ö†Ô∏è **–†–∏—Å–∫ #3: 3 –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ health check —Å 70% –æ–¥–∏–Ω–∞–∫–æ–≤–æ–≥–æ –∫–æ–¥–∞**
```
services/free-ai-selector-health-worker/app/main.py:
‚îú‚îÄ‚îÄ check_openai_format()      (—Å—Ç—Ä–æ–∫–∏ 68-111)
‚îú‚îÄ‚îÄ check_huggingface_format() (—Å—Ç—Ä–æ–∫–∏ 114-149)
‚îî‚îÄ‚îÄ check_cloudflare_format()  (—Å—Ç—Ä–æ–∫–∏ 152-201)
```

‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç: Use Case pattern**
```
services/free-ai-selector-business-api/app/application/use_cases/process_prompt.py
```
–ß—ë—Ç–∫–æ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π Use Case —Å –ø–æ–Ω—è—Ç–Ω–æ–π –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å—é.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É:**
1. **P1**: –û–±—ä–µ–¥–∏–Ω–∏—Ç—å error handlers –≤ `_handle_error()` –∏ `_handle_rate_limit()`
2. **P2**: –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å `get_statistics_for_period()` –Ω–∞ SQL aggregation
3. **P2**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Strategy pattern –¥–ª—è health check formats

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P1
**–û—Ü–µ–Ω–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è:** PARTIAL

---

## QC-3: YAGNI (You Aren't Gonna Need It)

**–¶–µ–ª—å:** –£–±—Ä–∞—Ç—å –ª–∏—à–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã, –Ω–µ –æ—Ç–Ω–æ—Å—è—â–∏–µ—Å—è –∫ —Ç–µ–∫—É—â–∏–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º.

**–ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:**
- [x] –£–¥–∞–ª–µ–Ω—ã –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã/–≤–µ—Ç–∫–∏/—Ñ–ª–∞–≥–∏
- [x] –£–¥–∞–ª–µ–Ω—ã "–∑–∞–≥–æ—Ç–æ–≤–∫–∏ –Ω–∞ –±—É–¥—É—â–µ–µ"
- [x] –û–±–æ–±—â–µ–Ω–∏—è –µ—Å—Ç—å —Ç–æ–ª—å–∫–æ —Ç–∞–º, –≥–¥–µ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç—å
- [x] ‚ö†Ô∏è AIDD: Level 2 (MVP) ‚Äî –Ω–µ –¥–æ–±–∞–≤–ª—è—Ç—å —Å–ª–æ–∂–Ω—É—é –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å

**–ö—Ä–∏—Ç–µ—Ä–∏–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è:** –ù–µ—Ç –∫–æ–¥–∞/–∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π –±–µ–∑ —Ç–µ–∫—É—â–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.

**–ù–∞–π–¥–µ–Ω–æ –≤ –∫–æ–¥–µ:**

‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç: –ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**
- –ù–µ—Ç –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π
- –í—Å–µ 14 –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ —Ä–µ–∞–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è
- Provider Registry —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã

‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç: Level 2 (MVP) requirements**
- –ù–µ—Ç —Å–ª–æ–∂–Ω–æ–≥–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è "–Ω–∞ –±—É–¥—É—â–µ–µ"
- –ù–µ—Ç message queues –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- –ü—Ä–æ—Å—Ç–∞—è fallback –ª–æ–≥–∏–∫–∞

üîí AIDD CONSTRAINT: –¢–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å ‚Äî MVP, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É:**
–ù–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π ‚Äî –ø—Ä–∏–Ω—Ü–∏–ø —Å–æ–±–ª—é–¥—ë–Ω.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** ‚Äî
**–û—Ü–µ–Ω–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è:** **PASS**

---

## QC-4: SRP (Single Responsibility Principle)

**–¶–µ–ª—å:** –ö–∞–∂–¥–∞—è —Ñ—É–Ω–∫—Ü–∏—è/–∫–ª–∞—Å—Å –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ–¥–Ω—É –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç—å.

**–ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:**
- [ ] –î–ª–∏–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –ø–æ —à–∞–≥–∞–º
- [ ] –ö–ª–∞—Å—Å—ã –Ω–µ —Å–º–µ—à–∏–≤–∞—é—Ç –¥–æ–º–µ–Ω–Ω—É—é –ª–æ–≥–∏–∫—É, I/O, –≤–∞–ª–∏–¥–∞—Ü–∏—é
- [x] ‚ö†Ô∏è AIDD: –°–ª–æ–∏ DDD/Hexagonal —Å–æ–±–ª—é–¥–µ–Ω—ã (api ‚Üí application ‚Üí domain)

**–ö—Ä–∏—Ç–µ—Ä–∏–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è:** –§—É–Ω–∫—Ü–∏—é/–∫–ª–∞—Å—Å –º–æ–∂–Ω–æ –æ–ø–∏—Å–∞—Ç—å –æ–¥–Ω–∏–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º –±–µ–∑ "–∏".

**–ù–∞–π–¥–µ–Ω–æ –≤ –∫–æ–¥–µ:**

‚ö†Ô∏è **–†–∏—Å–∫ #1: `ProcessPromptUseCase.execute()` ‚Äî 290 —Å—Ç—Ä–æ–∫**
```
services/free-ai-selector-business-api/app/application/use_cases/process_prompt.py:77-370
```
–í—ã–ø–æ–ª–Ω—è–µ—Ç 11 –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–µ–π:
1. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ö–æ–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
2. –ü–æ–ª—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –∏–∑ Data API
3. –í–∞–ª–∏–¥–∞—Ü–∏—è –º–æ–¥–µ–ª–µ–π
4. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è configured –º–æ–¥–µ–ª–µ–π
5. –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ reliability score
6. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ selection decision
7. Fallback loop
8. –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫
9. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ success
10. –ó–∞–ø–∏—Å—å –∏—Å—Ç–æ—Ä–∏–∏
11. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ response

‚ö†Ô∏è **–†–∏—Å–∫ #2: main.py –±–æ—Ç–∞ ‚Äî 476 —Å—Ç—Ä–æ–∫**
```
services/free-ai-selector-telegram-bot/app/main.py
```
–°–æ–¥–µ—Ä–∂–∏—Ç: –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é, HTTP-–∫–ª–∏–µ–Ω—Ç, 5 handlers, main function.

‚ö†Ô∏è **–†–∏—Å–∫ #3: `run_health_checks()` ‚Äî 108 —Å—Ç—Ä–æ–∫**
```
services/free-ai-selector-health-worker/app/main.py:266-374
```

‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç: DDD/Hexagonal layers**
```
app/
‚îú‚îÄ‚îÄ api/           ‚Üí HTTP endpoints (–≤—Ö–æ–¥—è—â–∏–µ –∞–¥–∞–ø—Ç–µ—Ä—ã)
‚îú‚îÄ‚îÄ application/   ‚Üí Use Cases (–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è)
‚îú‚îÄ‚îÄ domain/        ‚Üí –ß–∏—Å—Ç–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îî‚îÄ‚îÄ infrastructure/‚Üí AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã, HTTP –∫–ª–∏–µ–Ω—Ç—ã (–∏—Å—Ö–æ–¥—è—â–∏–µ –∞–¥–∞–ø—Ç–µ—Ä—ã)
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É:**
1. **P1**: –†–∞–∑–±–∏—Ç—å `execute()` –Ω–∞ `_select_model()`, `_handle_error()`, `_record_result()`
2. **P1**: –í—ã–¥–µ–ª–∏—Ç—å handlers –±–æ—Ç–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏
3. **P2**: –†–∞–∑–±–∏—Ç—å `run_health_checks()` –Ω–∞ –º–µ–Ω—å—à–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P1
**–û—Ü–µ–Ω–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è:** PARTIAL

---

## QC-5: OCP (Open/Closed Principle)

**–¶–µ–ª—å:** –£–ø—Ä–æ—Å—Ç–∏—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –ø–æ–≤–µ–¥–µ–Ω–∏—è.

**–ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:**
- [x] –í–∞—Ä–∏–∞—Ç–∏–≤–Ω—ã–µ —É—á–∞—Å—Ç–∫–∏ –≤—ã–¥–µ–ª–µ–Ω—ã (—Å—Ç—Ä–∞—Ç–µ–≥–∏–∏/registry)
- [x] –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–∞–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥
- [x] ‚ö†Ô∏è AIDD: Provider Registry ‚Äî –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

**–ö—Ä–∏—Ç–µ—Ä–∏–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è:** –ù–æ–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –Ω–æ–≤—ã–π –∫–æ–¥, –Ω–µ –º–∞—Å—Å–æ–≤—É—é –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—é.

**–ù–∞–π–¥–µ–Ω–æ –≤ –∫–æ–¥–µ:**

‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç: Provider Registry pattern**
```
services/free-ai-selector-business-api/app/infrastructure/ai_providers/registry.py
```
```python
PROVIDER_REGISTRY: dict[str, type[AIProviderBase]] = {
    "groq": GroqProvider,
    "cerebras": CerebrasProvider,
    # –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä = 1 —Å—Ç—Ä–æ–∫–∞
}
```

‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç: API Format Checkers**
```
services/free-ai-selector-health-worker/app/main.py:204-212
```
```python
API_FORMAT_CHECKERS = {
    "openai": check_openai_format,
    "huggingface": check_huggingface_format,
    "cloudflare": check_cloudflare_format,
}
```

üîí AIDD CONSTRAINT: –ù–æ–≤—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä —Ç—Ä–µ–±—É–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è 2 —Ñ–∞–π–ª–æ–≤ (registry.py + seed.py).

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É:**
–ù–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π ‚Äî –ø—Ä–∏–Ω—Ü–∏–ø —Å–æ–±–ª—é–¥—ë–Ω.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** ‚Äî
**–û—Ü–µ–Ω–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è:** **PASS**

---

## QC-6: LSP (Liskov Substitution Principle)

**–¶–µ–ª—å:** –ü–æ–¥—Ç–∏–ø—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ –≤–∑–∞–∏–º–æ–∑–∞–º–µ–Ω—è–µ–º—ã —Å –±–∞–∑–æ–≤—ã–º–∏ —Ç–∏–ø–∞–º–∏.

**–ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:**
- [x] –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–µ –ª–æ–º–∞—é—Ç –∫–æ–Ω—Ç—Ä–∞–∫—Ç
- [ ] ‚ö†Ô∏è AIDD: –í—Å–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã –û–ë–Ø–ó–ê–ù–´ —Å–æ–±–ª—é–¥–∞—Ç—å –∫–æ–Ω—Ç—Ä–∞–∫—Ç AIProviderBase

**–ö—Ä–∏—Ç–µ—Ä–∏–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è:** –õ—é–±–∞—è –∑–∞–º–µ–Ω–∞ –±–∞–∑–æ–≤–æ–≥–æ —Ç–∏–ø–∞ –Ω–∞ –ø–æ–¥—Ç–∏–ø –Ω–µ –º–µ–Ω—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å.

**–ù–∞–π–¥–µ–Ω–æ –≤ –∫–æ–¥–µ:**

‚ö†Ô∏è **–†–∏—Å–∫ #1: –ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã –±—Ä–æ—Å–∞—é—Ç –Ω–µ–∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è**
```
services/free-ai-selector-business-api/app/infrastructure/ai_providers/*.py
```
–ö–æ–Ω—Ç—Ä–∞–∫—Ç `AIProviderBase.generate()`:
```python
@abstractmethod
async def generate(self, prompt: str, **kwargs) -> str:
    """Raises: Exception: If generation fails"""
```

–ù–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã –±—Ä–æ—Å–∞—é—Ç:
- `ValueError` –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ API key (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ `__init__`)
- `httpx.HTTPError` –±–µ–∑ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤ ProviderError

‚ö†Ô∏è **–†–∏—Å–∫ #2: Cloudflare –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–º–µ—Å—Ç–∏–º**
```
services/free-ai-selector-business-api/app/infrastructure/ai_providers/cloudflare.py
```
- –¢—Ä–µ–±—É–µ—Ç `account_id` –ø–æ–º–∏–º–æ `api_token`
- –î—Ä—É–≥–æ–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ (`result.response` vs `choices[0].message.content`)
- –ù–µ—Ç `top_p` –≤ payload

‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç: 11 OpenAI-compatible –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤**
–í—Å–µ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç `str` –∏–∑ `generate()`, –≤—Å–µ —Ä–µ–∞–ª–∏–∑—É—é—Ç `health_check()` ‚Üí `bool`.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É:**
1. **P2**: –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å API key –≤ `__init__`, –Ω–µ –≤ `generate()`
2. **P2**: –û–±–µ—Ä–Ω—É—Ç—å `httpx.HTTPError` –≤ `ProviderError` –≤–Ω—É—Ç—Ä–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P2
**–û—Ü–µ–Ω–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è:** PARTIAL

---

## QC-7: ISP (Interface Segregation Principle)

**–¶–µ–ª—å:** –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã/Protocol –º–∏–Ω–∏–º–∞–ª—å–Ω—ã.

**–ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:**
- [x] –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –ø–æ —Ä–æ–ª—è–º
- [x] –ù–µ—Ç "–∫–æ–º–±–∞–π–Ω–æ–≤"
- [x] ‚ö†Ô∏è AIDD: AIProviderBase ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç (3 –º–µ—Ç–æ–¥–∞)

**–ö—Ä–∏—Ç–µ—Ä–∏–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è:** –ù–µ—Ç –º–µ—Ç–æ–¥–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è.

**–ù–∞–π–¥–µ–Ω–æ –≤ –∫–æ–¥–µ:**

‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤**
```
services/free-ai-selector-business-api/app/infrastructure/ai_providers/base.py
```
```python
class AIProviderBase(ABC):
    @abstractmethod
    async def generate(self, prompt: str, **kwargs) -> str: ...

    @abstractmethod
    async def health_check(self) -> bool: ...

    @abstractmethod
    def get_provider_name(self) -> str: ...
```
–¢–æ–ª—å–∫–æ 3 –º–µ—Ç–æ–¥–∞ ‚Äî –≤—Å–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è.

‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç: Repository interfaces**
–ù–µ—Ç –∏–∑–±—ã—Ç–æ—á–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤ –≤ `AIModelRepository` –∏ `PromptHistoryRepository`.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É:**
–ù–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π ‚Äî –ø—Ä–∏–Ω—Ü–∏–ø —Å–æ–±–ª—é–¥—ë–Ω.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** ‚Äî
**–û—Ü–µ–Ω–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è:** **PASS**

---

## QC-8: DIP (Dependency Inversion Principle)

**–¶–µ–ª—å:** –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∑–∞–º–µ–Ω—è–µ–º—ã, –¥–æ–º–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω–∞ –∫ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–µ.

**–ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:**
- [x] –í–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–Ω–∂–µ–∫—Ç–∏—Ä—É—é—Ç—Å—è
- [ ] ‚ö†Ô∏è AIDD: DataAPIClient –∏–Ω–∂–µ–∫—Ç–∏—Ä—É–µ—Ç—Å—è –≤ Use Cases

**–ö—Ä–∏—Ç–µ—Ä–∏–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è:** –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏.

**–ù–∞–π–¥–µ–Ω–æ –≤ –∫–æ–¥–µ:**

‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç: DataAPIClient –∏–Ω–∂–µ–∫—Ç–∏—Ä—É–µ—Ç—Å—è**
```
services/free-ai-selector-business-api/app/application/use_cases/process_prompt.py:67-74
```
```python
class ProcessPromptUseCase:
    def __init__(self, data_api_client: DataAPIClient):
        self.data_api_client = data_api_client
```

‚ö†Ô∏è **–†–∏—Å–∫ #1: –ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã —Å–æ–∑–¥–∞—é—Ç httpx.AsyncClient –≤–Ω—É—Ç—Ä–∏**
```
services/free-ai-selector-business-api/app/infrastructure/ai_providers/*.py
```
```python
async with httpx.AsyncClient(timeout=self.timeout) as client:
    # –ù–µ–ª—å–∑—è –∏–Ω–∂–µ–∫—Ç–∏—Ç—å mock client –¥–ª—è —Ç–µ—Å—Ç–æ–≤
```

‚ö†Ô∏è **–†–∏—Å–∫ #2: –ë–æ—Ç –∏ Worker —Å–æ–∑–¥–∞—é—Ç HTTP –∫–ª–∏–µ–Ω—Ç—ã –Ω–∞–ø—Ä—è–º—É—é**
```
services/free-ai-selector-telegram-bot/app/main.py:62,85,107
services/free-ai-selector-health-worker/app/main.py:87,132,180,284,330,397
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É:**
1. **P2**: –ò–Ω–∂–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å HTTP client –≤ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
2. **P2**: –°–æ–∑–¥–∞—Ç—å `BusinessAPIClient` –¥–ª—è –±–æ—Ç–∞

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P2
**–û—Ü–µ–Ω–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è:** PARTIAL

---

## QC-9: SoC (Separation of Concerns)

**–¶–µ–ª—å:** –ù–µ —Å–º–µ—à–∏–≤–∞—Ç—å —É—Ä–æ–≤–Ω–∏ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏.

**–ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:**
- [x] –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –æ—Ç–¥–µ–ª–µ–Ω–∞ –æ—Ç I/O
- [x] ‚ö†Ô∏è AIDD: HTTP-only –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º —Å–æ–±–ª—é–¥–∞–µ—Ç—Å—è

**–ö—Ä–∏—Ç–µ—Ä–∏–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è:** –ö–∞–∂–¥–∞—è —Ñ—É–Ω–∫—Ü–∏—è/–º–æ–¥—É–ª—å –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ–¥–∏–Ω "—Å–ª–æ–π".

**–ù–∞–π–¥–µ–Ω–æ –≤ –∫–æ–¥–µ:**

‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç: HTTP-only –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**
```
Business API ‚îÄ‚îÄHTTP‚îÄ‚îÄ‚ñ∂ Data API ‚îÄ‚îÄSQL‚îÄ‚îÄ‚ñ∂ PostgreSQL
```
Business API –ù–ò–ö–û–ì–î–ê –Ω–µ –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ –ë–î –Ω–∞–ø—Ä—è–º—É—é.

‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç: –°–ª–æ–∏ DDD/Hexagonal**
- `domain/` ‚Äî —á–∏—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞ –±–µ–∑ I/O
- `infrastructure/` ‚Äî –≤–Ω–µ—à–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
- `application/` ‚Äî –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è

üîí AIDD CONSTRAINT: HTTP-only –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º ‚Äî —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π –ø—Ä–∏–Ω—Ü–∏–ø.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É:**
–ù–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π ‚Äî –ø—Ä–∏–Ω—Ü–∏–ø —Å–æ–±–ª—é–¥—ë–Ω.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** ‚Äî
**–û—Ü–µ–Ω–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è:** **PASS**

---

## QC-10: SSoT (Single Source of Truth)

**–¶–µ–ª—å:** –ï–¥–∏–Ω—ã–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–∏–ø–æ–≤/–∫–æ–Ω—Å—Ç–∞–Ω—Ç/–ø—Ä–∞–≤–∏–ª.

**–ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:**
- [x] –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –Ω–µ –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è
- [ ] ‚ö†Ô∏è AIDD: Provider metadata ‚Üí seed.py, Classes ‚Üí registry.py

**–ö—Ä–∏—Ç–µ—Ä–∏–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è:** –ö–∞–∂–¥—ã–π —Ç–∏–ø/–ø—Ä–∞–≤–∏–ª–æ/–∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ.

**–ù–∞–π–¥–µ–Ω–æ –≤ –∫–æ–¥–µ:**

‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç: Provider SSOT**
```
seed.py     ‚Üí Metadata (name, endpoint, api_format, env_var)
registry.py ‚Üí Class mapping (name ‚Üí ProviderClass)
```

‚ö†Ô∏è **–†–∏—Å–∫ #1: Magic numbers –≤ reliability calculation**
```
services/free-ai-selector-data-postgres-api/app/domain/models.py:56-80
```
```python
if avg_time >= 10.0:  # Magic number
    return 0.0
return (self.success_rate * 0.6) + (self.speed_score * 0.4)  # Magic numbers
```

‚ö†Ô∏è **–†–∏—Å–∫ #2: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ regex –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤**
```
services/free-ai-selector-business-api/app/utils/security.py:49-116
services/free-ai-selector-business-api/app/utils/sensitive_filter.py:30-38
```
–û–¥–Ω–∏ –∏ —Ç–µ –∂–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è API keys –≤ –¥–≤—É—Ö —Ñ–∞–π–ª–∞—Ö.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É:**
1. **P2**: –í—ã–Ω–µ—Å—Ç–∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã reliability calculation
2. **P2**: –û–±—ä–µ–¥–∏–Ω–∏—Ç—å regex –ø–∞—Ç—Ç–µ—Ä–Ω—ã –≤ –æ–¥–∏–Ω –º–æ–¥—É–ª—å

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P2
**–û—Ü–µ–Ω–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è:** PARTIAL

---

## QC-11: LoD (Law of Demeter)

**–¶–µ–ª—å:** –°–Ω–∏–∑–∏—Ç—å —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å.

**–ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:**
- [x] –£–º–µ–Ω—å—à–µ–Ω—ã —Ü–µ–ø–æ—á–∫–∏ –æ–±—Ä–∞—â–µ–Ω–∏–π
- [x] ‚ö†Ô∏è AIDD: –°–µ—Ä–≤–∏—Å—ã –æ–±—â–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ HTTP (–Ω–µ –ø—Ä—è–º—ã–µ –∏–º–ø–æ—Ä—Ç—ã)

**–ö—Ä–∏—Ç–µ—Ä–∏–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è:** –§—É–Ω–∫—Ü–∏—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Ç–æ–ª—å–∫–æ —Å –ø—Ä—è–º—ã–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏.

**–ù–∞–π–¥–µ–Ω–æ –≤ –∫–æ–¥–µ:**

‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç: –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è**
–°–µ—Ä–≤–∏—Å—ã –æ–±—â–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ HTTP, –Ω–µ—Ç –ø—Ä—è–º—ã—Ö –∏–º–ø–æ—Ä—Ç–æ–≤ –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏.

‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ü–µ–ø–æ—á–∫–∏**
```python
# –•–æ—Ä–æ—à–æ
model.reliability_score  # property, –Ω–µ model.stats.reliability.score
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É:**
–ù–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π ‚Äî –ø—Ä–∏–Ω—Ü–∏–ø —Å–æ–±–ª—é–¥—ë–Ω.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** ‚Äî
**–û—Ü–µ–Ω–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è:** **PASS**

---

## QC-12: CoC (Convention over Configuration)

**–¶–µ–ª—å:** –ö–æ–¥ —Å–ª–µ–¥—É–µ—Ç —Å–æ–≥–ª–∞—à–µ–Ω–∏—è–º –ø—Ä–æ–µ–∫—Ç–∞.

**–ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:**
- [x] –ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ –ø–æ conventions.md
- [x] ‚ö†Ô∏è AIDD: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ DDD/Hexagonal —Å–æ–±–ª—é–¥–µ–Ω–∞

**–ö—Ä–∏—Ç–µ—Ä–∏–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è:** –ö–æ–¥ –≤—ã–≥–ª—è–¥–∏—Ç "–∫–∞–∫ —á–∞—Å—Ç—å –ø—Ä–æ–µ–∫—Ç–∞".

**–ù–∞–π–¥–µ–Ω–æ –≤ –∫–æ–¥–µ:**

‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç: –ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ**
- –ú–æ–¥—É–ª–∏: `snake_case.py` ‚úì
- –ö–ª–∞—Å—Å—ã: `PascalCase` ‚úì
- –§—É–Ω–∫—Ü–∏–∏: `snake_case()` ‚úì
- –°–µ—Ä–≤–∏—Å—ã: `{context}_{domain}_{type}` ‚úì

‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–µ—Ä–≤–∏—Å–æ–≤**
```
app/
‚îú‚îÄ‚îÄ api/v1/
‚îú‚îÄ‚îÄ application/
‚îú‚îÄ‚îÄ domain/
‚îú‚îÄ‚îÄ infrastructure/
‚îî‚îÄ‚îÄ utils/
```

‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç: Type hints**
–í–µ–∑–¥–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è type hints.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É:**
–ù–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π ‚Äî –ø—Ä–∏–Ω—Ü–∏–ø —Å–æ–±–ª—é–¥—ë–Ω.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** ‚Äî
**–û—Ü–µ–Ω–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è:** **PASS**

---

## QC-13: Fail Fast

**–¶–µ–ª—å:** –†–∞–Ω–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ö–æ–¥–æ–≤, —è–≤–Ω—ã–µ –æ—à–∏–±–∫–∏.

**–ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:**
- [x] –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–µ
- [ ] Guard clauses –≤–º–µ—Å—Ç–æ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏
- [x] ‚ö†Ô∏è AIDD: Domain exceptions –¥–ª—è –æ—à–∏–±–æ–∫ AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

**–ö—Ä–∏—Ç–µ—Ä–∏–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è:** –ü—Ä–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∫–æ–¥ –ø–∞–¥–∞–µ—Ç –±—ã—Å—Ç—Ä–æ –∏ –æ–±—ä—è—Å–Ω–∏–º–æ.

**–ù–∞–π–¥–µ–Ω–æ –≤ –∫–æ–¥–µ:**

‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç: Pydantic –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –≤—Ö–æ–¥–µ**
```
services/free-ai-selector-business-api/app/api/v1/schemas.py:19-32
```
```python
class ProcessPromptRequest(BaseModel):
    prompt: str = Field(..., min_length=1, max_length=10000)
    system_prompt: Optional[str] = Field(default=None, max_length=5000)
```

‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç: Domain exceptions (F012)**
```
services/free-ai-selector-business-api/app/domain/exceptions.py
```
`RateLimitError`, `ServerError`, `TimeoutError`, `AuthenticationError`, etc.

‚ö†Ô∏è **–†–∏—Å–∫ #1: –í–∞–ª–∏–¥–∞—Ü–∏—è API key –≤ generate() –≤–º–µ—Å—Ç–æ __init__()**
```
services/free-ai-selector-business-api/app/infrastructure/ai_providers/*.py:62-63
```
```python
async def generate(self, prompt: str, **kwargs) -> str:
    if not self.api_key:
        raise ValueError("... API key is required")  # –ü–æ–∑–¥–Ω–æ!
```

‚ö†Ô∏è **–†–∏—Å–∫ #2: –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ response_format dict**
```
services/free-ai-selector-business-api/app/api/v1/schemas.py:29
```
```python
response_format: Optional[dict] = Field(default=None)
# –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã!
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É:**
1. **P2**: –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—é API key –≤ `__init__`
2. **P2**: –î–æ–±–∞–≤–∏—Ç—å Pydantic validator –¥–ª—è `response_format`

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P2
**–û—Ü–µ–Ω–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è:** PARTIAL

---

## QC-14: Explicit > Implicit

**–¶–µ–ª—å:** –ü–æ–≤–µ–¥–µ–Ω–∏–µ –æ—á–µ–≤–∏–¥–Ω–æ –∏–∑ –∫–æ–¥–∞.

**–ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:**
- [x] Type hints –≤–µ–∑–¥–µ
- [x] –ú–∞–≥–∏—á–µ—Å–∫–∏–µ —á–∏—Å–ª–∞ –≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
- [x] ‚ö†Ô∏è AIDD: Docstrings –Ω–∞ —Ä—É—Å—Å–∫–æ–º (Google-—Å—Ç–∏–ª—å)

**–ö—Ä–∏—Ç–µ—Ä–∏–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è:** –ü–æ–Ω–∏–º–∞–Ω–∏–µ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç —á—Ç–µ–Ω–∏—è "–ø–æ–ª–æ–≤–∏–Ω—ã –ø—Ä–æ–µ–∫—Ç–∞".

**–ù–∞–π–¥–µ–Ω–æ –≤ –∫–æ–¥–µ:**

‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç: Type hints –≤–µ–∑–¥–µ**
```python
async def execute(self, request: PromptRequest) -> PromptResponse:
```

‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç: Pydantic models –¥–ª—è API**
–í—Å–µ endpoints –∏—Å–ø–æ–ª—å–∑—É—é—Ç typed schemas.

‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç: –Ø–≤–Ω—ã–µ error types**
```python
class RateLimitError(ProviderError): ...
class ServerError(ProviderError): ...
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É:**
–ù–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π ‚Äî –ø—Ä–∏–Ω—Ü–∏–ø —Å–æ–±–ª—é–¥—ë–Ω.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** ‚Äî
**–û—Ü–µ–Ω–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è:** **PASS**

---

## QC-15: Composition > Inheritance

**–¶–µ–ª—å:** –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ –∫–æ–º–ø–æ–∑–∏—Ü–∏—é, –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –ø–æ —Å–º—ã—Å–ª—É.

**–ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:**
- [ ] –ù–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –¥–ª—è is-a
- [ ] –ì–ª—É–±–∏–Ω–∞ –∏–µ—Ä–∞—Ä—Ö–∏–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∞
- [x] ‚ö†Ô∏è AIDD: –ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã –Ω–∞—Å–ª–µ–¥—É—é—Ç —Ç–æ–ª—å–∫–æ AIProviderBase

**–ö—Ä–∏—Ç–µ—Ä–∏–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è:** –ö–∞–∂–¥–æ–µ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∏–º–µ–µ—Ç –¥–æ–º–µ–Ω–Ω–æ–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ.

**–ù–∞–π–¥–µ–Ω–æ –≤ –∫–æ–¥–µ:**

‚ùå **–ù–∞—Ä—É—à–µ–Ω–∏–µ: 11 –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –Ω–∞—Å–ª–µ–¥—É—é—Ç AIProviderBase, –Ω–æ –Ω–µ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É—é—Ç –∫–æ–¥**
```
services/free-ai-selector-business-api/app/infrastructure/ai_providers/
```
–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:
```python
class GroqProvider(AIProviderBase):
    # ~140 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞

class CerebrasProvider(AIProviderBase):
    # ~140 —Å—Ç—Ä–æ–∫ –¢–û–ì–û –ñ–ï –∫–æ–¥–∞
```

–ü—Ä–æ–±–ª–µ–º–∞: –ù–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞, –Ω–æ –∫–æ–¥ –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è.
–†–µ—à–µ–Ω–∏–µ: Composition —á–µ—Ä–µ–∑ `OpenAICompatibleProvider`:
```python
class OpenAICompatibleProvider(AIProviderBase):
    """–ë–∞–∑–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è OpenAI-compatible –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤."""
    # ~100 —Å—Ç—Ä–æ–∫ –æ–±—â–µ–≥–æ –∫–æ–¥–∞

class GroqProvider(OpenAICompatibleProvider):
    """Groq-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è."""
    provider_name = "groq"
    api_url = "https://api.groq.com/openai/v1/chat/completions"
    env_var = "GROQ_API_KEY"
    # ~10 —Å—Ç—Ä–æ–∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```

‚ö†Ô∏è **–†–∏—Å–∫: Cloudflare –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –ø–æ–¥ OpenAI-compatible**
–¢—Ä–µ–±—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (–¥—Ä—É–≥–æ–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞).

‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç: Domain exceptions hierarchy**
```python
class ProviderError(Exception): ...
class RateLimitError(ProviderError): ...  # is-a ProviderError ‚úì
class ServerError(ProviderError): ...     # is-a ProviderError ‚úì
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É:**
1. **P0**: –°–æ–∑–¥–∞—Ç—å `OpenAICompatibleProvider` –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π –∫–ª–∞—Å—Å
2. **P0**: –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å 11 –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P0
**–û—Ü–µ–Ω–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è:** **FAIL**

---

## QC-16: Testability

**–¶–µ–ª—å:** –ú–æ–¥—É–ª—å –ª–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å unit-—Ç–µ—Å—Ç–∞–º–∏.

**–ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:**
- [ ] –§—É–Ω–∫—Ü–∏–∏ –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω—ã
- [ ] –ü–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã
- [x] ‚ö†Ô∏è AIDD: Coverage ‚â•75%

**–ö—Ä–∏—Ç–µ—Ä–∏–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è:** Unit-—Ç–µ—Å—Ç –º–æ–∂–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å –≤ ~10‚Äì15 —Å—Ç—Ä–æ–∫.

**–ù–∞–π–¥–µ–Ω–æ –≤ –∫–æ–¥–µ:**

‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç: –¢–µ—Å—Ç—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç**
```
services/free-ai-selector-business-api/tests/
services/free-ai-selector-data-postgres-api/tests/
```

‚ö†Ô∏è **–†–∏—Å–∫ #1: –ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã —Å–æ–∑–¥–∞—é—Ç HTTP client –≤–Ω—É—Ç—Ä–∏**
–ù–µ–ª—å–∑—è –ø–æ–¥–º–µ–Ω–∏—Ç—å client –¥–ª—è unit-—Ç–µ—Å—Ç–æ–≤ –±–µ–∑ monkey-patching.

‚ö†Ô∏è **–†–∏—Å–∫ #2: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ test fixtures**
```
services/free-ai-selector-data-postgres-api/tests/unit/test_ai_model_repository.py
```
AIModel —Å–æ–∑–¥–∞—ë—Ç—Å—è 15 —Ä–∞–∑ —Å –ø–æ—á—Ç–∏ –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–º –∫–æ–¥–æ–º (—Å—Ç—Ä–æ–∫–∏ 23-36, 50-63, ...).

‚ö†Ô∏è **–†–∏—Å–∫ #3: –¢–µ—Å—Ç—ã –∑–∞–≤–∏—Å—è—Ç –æ—Ç –≤—Ä–µ–º–µ–Ω–∏**
```python
created_at=datetime.utcnow()  # –ù–µ–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–æ
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É:**
1. **P1**: –°–æ–∑–¥–∞—Ç—å test factory `make_ai_model()` –≤ conftest.py
2. **P2**: –ò–Ω–∂–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å HTTP client –≤ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã
3. **P2**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `freezegun` –¥–ª—è –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P1
**–û—Ü–µ–Ω–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è:** PARTIAL

---

## QC-17: Security

**–¶–µ–ª—å:** –£—Å—Ç—Ä–∞–Ω–∏—Ç—å —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –∏ —É—Ç–µ—á–∫–∏.

**–ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:**
- [x] –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è
- [x] –°–µ–∫—Ä–µ—Ç—ã –Ω–µ —Ö–∞—Ä–¥–∫–æ–¥—è—Ç—Å—è
- [x] ‚ö†Ô∏è AIDD: sanitize_error_message() –¥–ª—è –≤—Å–µ—Ö –æ—à–∏–±–æ–∫
- [x] ‚ö†Ô∏è AIDD: .env —Ñ–∞–π–ª—ã –ù–ò–ö–û–ì–î–ê –Ω–µ —á–∏—Ç–∞—é—Ç—Å—è AI

**–ö—Ä–∏—Ç–µ—Ä–∏–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è:** –ù–µ—Ç –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π.

**–ù–∞–π–¥–µ–Ω–æ –≤ –∫–æ–¥–µ:**

‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç: sanitize_error_message() –≤–µ–∑–¥–µ**
```
services/*/app/utils/security.py
```
12 regex –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –¥–ª—è –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤.

‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç: Pydantic –≤–∞–ª–∏–¥–∞—Ü–∏—è**
```python
prompt: str = Field(..., min_length=1, max_length=10000)
```

‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç: SQL Injection protected**
SQLAlchemy ORM —Å parameterized queries.

‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç: –°–µ–∫—Ä–µ—Ç—ã –∏–∑ env**
```python
self.api_key = os.getenv(env_var, "") or None
```

‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç: SensitiveDataFilter –¥–ª—è –ª–æ–≥–æ–≤**
```
services/*/app/utils/sensitive_filter.py
```

üîí AIDD CONSTRAINT: .env —Ñ–∞–π–ª—ã –Ω–µ —á–∏—Ç–∞—é—Ç—Å—è AI ‚Äî —Å–æ–±–ª—é–¥–µ–Ω–æ.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É:**
–ù–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** ‚Äî
**–û—Ü–µ–Ω–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è:** **PASS**

---

## Top P0 Issues

| # | –ü—Ä–æ–±–ª–µ–º–∞ | –§–∞–π–ª—ã | Impact |
|---|----------|-------|--------|
| 1 | **~1,100 —Å—Ç—Ä–æ–∫ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –≤ 11 AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞—Ö** | `ai_providers/*.py` | –ü–æ–¥–¥–µ—Ä–∂–∫–∞, –±–∞–≥–∏ |
| 2 | **–ù–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –±–µ–∑ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞** | `ai_providers/*.py` | –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ |
| 3 | **–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç `OpenAICompatibleProvider` –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å** | `ai_providers/base.py` | DRY, Composition |

---

## AIDD Constraints Identified

| –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ | –§–∞–π–ª/–û–±–ª–∞—Å—Ç—å | –í–ª–∏—è–Ω–∏–µ –Ω–∞ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ |
|-------------|--------------|------------------------|
| HTTP-only –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º | Business API | –ù–µ–ª—å–∑—è –¥–æ–±–∞–≤–ª—è—Ç—å –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ –ë–î |
| Provider Registry SSOT | registry.py + seed.py | –û–±–Ω–æ–≤–ª—è—Ç—å –û–ë–ê —Ñ–∞–π–ª–∞ |
| Shared utils —á–µ—Ä–µ–∑ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ | services/*/utils/ | –ù–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å shared package |
| Level 2 (MVP) | –í–µ—Å—å –ø—Ä–æ–µ–∫—Ç | –ù–µ –¥–æ–±–∞–≤–ª—è—Ç—å —Å–ª–æ–∂–Ω—É—é –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å |
| AIProviderBase –∫–æ–Ω—Ç—Ä–∞–∫—Ç | ai_providers/base.py | –í—Å–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã –¥–æ–ª–∂–Ω—ã —Å–æ–±–ª—é–¥–∞—Ç—å |

---

## Refactoring Plan (7 —à–∞–≥–æ–≤)

### Phase 1: Provider Consolidation (P0)
**–®–∞–≥ 1**: –°–æ–∑–¥–∞—Ç—å `OpenAICompatibleProvider` –≤ `ai_providers/base.py`
- –í—ã–Ω–µ—Å—Ç–∏ –æ–±—â—É—é –ª–æ–≥–∏–∫—É: generate(), health_check(), headers, payload
- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å `AIProviderBase` –∫–∞–∫ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç

**–®–∞–≥ 2**: –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å 11 –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- –ö–∞–∂–¥—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä: ~10 —Å—Ç—Ä–æ–∫ –≤–º–µ—Å—Ç–æ ~140
- Cloudflare –æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ (–Ω–µ OpenAI-compatible)

### Phase 2: Error Handling Simplification (P1)
**–®–∞–≥ 3**: –°–æ–∑–¥–∞—Ç—å `_handle_error()` –≤ `process_prompt.py`
- –û–±—ä–µ–¥–∏–Ω–∏—Ç—å 5 except –±–ª–æ–∫–æ–≤ –≤ 2
- –°–æ–∫—Ä–∞—Ç–∏—Ç—å `execute()` –Ω–∞ ~80 —Å—Ç—Ä–æ–∫

### Phase 3: Data API Cleanup (P1)
**–®–∞–≥ 4**: –û–±—ä–µ–¥–∏–Ω–∏—Ç—å `_model_to_response()` —Ñ—É–Ω–∫—Ü–∏–∏
- –î–æ–±–∞–≤–∏—Ç—å optional `recent_metrics` –ø–∞—Ä–∞–º–µ—Ç—Ä

**–®–∞–≥ 5**: –°–æ–∑–¥–∞—Ç—å dependency `get_model_or_404()`
- –£—Å—Ç—Ä–∞–Ω–∏—Ç—å 7 –º–µ—Å—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è

### Phase 4: Test Improvements (P1)
**–®–∞–≥ 6**: –°–æ–∑–¥–∞—Ç—å test factories –≤ conftest.py
- `make_ai_model()` ‚Äî –∑–∞–º–µ–Ω–∏—Ç—å 15 –¥—É–±–ª–µ–π

### Phase 5: Minor Improvements (P2)
**–®–∞–≥ 7**: –í—ã–Ω–µ—Å—Ç–∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã reliability calculation
- `SPEED_BASELINE_SECONDS = 10.0`
- `SUCCESS_WEIGHT = 0.6`, `SPEED_WEIGHT = 0.4`

---

## Quick Wins (‚â§ 1h)

| # | –î–µ–π—Å—Ç–≤–∏–µ | –§–∞–π–ª | –í—Ä–µ–º—è | Impact |
|---|----------|------|-------|--------|
| 1 | –°–æ–∑–¥–∞—Ç—å `get_model_or_404()` dependency | `models.py` (Data API) | 30min | DRY |
| 2 | –û–±—ä–µ–¥–∏–Ω–∏—Ç—å `_model_to_response()` | `models.py` (Data API) | 30min | DRY |
| 3 | –í—ã–Ω–µ—Å—Ç–∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã reliability | `domain/models.py` | 15min | SSoT |
| 4 | –î–æ–±–∞–≤–∏—Ç—å test factory `make_ai_model()` | `conftest.py` | 30min | Testability |
| 5 | –í–∞–ª–∏–¥–∞—Ü–∏—è API key –≤ `__init__` | `base.py` | 20min | Fail Fast |

---

## Suggested Unit Tests

| # | Test Case | –†–∏—Å–∫ –ø–æ–∫—Ä—ã–≤–∞–µ—Ç |
|---|-----------|----------------|
| 1 | `test_openai_compatible_provider_generate_success` | –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ |
| 2 | `test_openai_compatible_provider_missing_api_key_raises` | Fail Fast (init) |
| 3 | `test_openai_compatible_provider_http_error_classified` | LSP (error classification) |
| 4 | `test_process_prompt_error_handler_rate_limit` | Error handling consolidation |
| 5 | `test_process_prompt_error_handler_server_error` | Error handling consolidation |
| 6 | `test_model_to_response_without_recent_metrics` | –û–±—ä–µ–¥–∏–Ω—ë–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è |
| 7 | `test_model_to_response_with_recent_metrics` | –û–±—ä–µ–¥–∏–Ω—ë–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è |
| 8 | `test_reliability_calculation_constants_used` | SSoT (–∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã) |
| 9 | `test_provider_inherits_from_openai_compatible` | Composition |
| 10 | `test_cloudflare_has_separate_implementation` | LSP (—Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å–ª—É—á–∞–π) |

---

## Files Changed Summary (–ø—Ä–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ)

| –§–∞–π–ª | –ò–∑–º–µ–Ω–µ–Ω–∏–µ | –†–∏—Å–∫ | AIDD Check |
|------|-----------|------|------------|
| `ai_providers/base.py` | –î–æ–±–∞–≤–∏—Ç—å OpenAICompatibleProvider | Medium | ‚úÖ OK |
| `ai_providers/groq.py` | –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é | Low | ‚úÖ OK |
| `ai_providers/*.py` (x11) | –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é | Low | ‚úÖ OK |
| `ai_providers/cloudflare.py` | –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π | ‚Äî | ‚úÖ OK |
| `process_prompt.py` | –°–æ–∑–¥–∞—Ç—å _handle_error() | Medium | ‚úÖ OK |
| `api/v1/models.py` (Data) | –û–±—ä–µ–¥–∏–Ω–∏—Ç—å _model_to_response | Low | ‚úÖ OK |
| `api/v1/models.py` (Data) | –î–æ–±–∞–≤–∏—Ç—å get_model_or_404 | Low | ‚úÖ OK |
| `domain/models.py` (Data) | –í—ã–Ω–µ—Å—Ç–∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã | Low | ‚úÖ OK |
| `tests/conftest.py` | –î–æ–±–∞–≤–∏—Ç—å factories | Low | ‚úÖ OK |

---

**–û—Ç—á—ë—Ç –≥–æ—Ç–æ–≤ –∫ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏—é.**

–ñ–¥—É –≤–∞—à–µ–≥–æ –æ–¥–æ–±—Ä–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–π.
